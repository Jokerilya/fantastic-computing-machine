{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\Tinymce\\components\\EditorImage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\Tinymce\\components\\EditorImage.vue","mtime":1670046758181},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnYXBpL3Fpbml1JwppbXBvcnQgeyBxaW5pdUhvc3QgfSBmcm9tICJAL3dlYkNvbmZpZy5qcyI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IHsgVXBsb2FkSW1nIH0gZnJvbSAiQC9hcGkvc3lzdGVtLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJFZGl0b3JTbGlkZVVwbG9hZCIsCiAgcHJvcHM6IHsKICAgIGNvbG9yOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogIiMxODkwZmYiLAogICAgfSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBxaW5pdUhvc3Q6IHFpbml1SG9zdCwKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGxpc3RPYmo6IHt9LAogICAgICBmaWxlTGlzdDogW10sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWyJ0b2tlbiJdKSwKICAgIGZpbGVQcm9ncmVzcygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuZmlsZVByb2dyZXNzOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGNoZWNrQWxsU3VjY2VzcygpIHsKICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMubGlzdE9iaikuZXZlcnkoCiAgICAgICAgKGl0ZW0pID0+IHRoaXMubGlzdE9ialtpdGVtXS5oYXNTdWNjZXNzCiAgICAgICk7CiAgICB9LAogICAgaHR0cFJlcXVlc3RGbihkYXRhKSB7CiAgICAgIGNvbnN0IGxvYWRpbmcgPSB0aGlzLiRsb2FkaW5nKHsgdGV4dDogIuS4iuS8oOS4rS4uIiB9KTsKICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgZm9ybURhdGEuYXBwZW5kKCJmaWxlIiwgZGF0YS5maWxlKTsKICAgICAgVXBsb2FkSW1nKGZvcm1EYXRhKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7CiAgICAgICAgICB0aGlzLiRlbWl0KCJ1cGxvYWRTdWMiLCByZXMpOwogICAgICAgICAgdGhpcy5oYW5kbGVTdWNjZXNzKHJlcy5kYXRhLCBkYXRhLmZpbGUpOwogICAgICAgICAgaWYgKHRoaXMuY2hlY2tBbGxTdWNjZXNzKCkpIHsKICAgICAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICBzaG93Q2xvc2U6IHRydWUsCiAgICAgICAgICAgICAgbWVzc2FnZTogIuWbvueJh+S4iuS8oOaIkOWKn++8geeCueWHu+ehruiupOaPkuWFpeaWh+acrOe8lui+keWZqCIsCiAgICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgc2hvd0Nsb3NlOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiAi5paH5Lu25LiK5Lyg5aSx6LSl77yBIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgfSk7CiAgICAgICAgICBsb2FkaW5nLmNsb3NlKCk7CiAgICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlU3VibWl0KCkgewogICAgICBjb25zdCBhcnIgPSBPYmplY3Qua2V5cyh0aGlzLmxpc3RPYmopLm1hcCgodikgPT4gdGhpcy5saXN0T2JqW3ZdKTsKICAgICAgaWYgKCF0aGlzLmNoZWNrQWxsU3VjY2VzcygpKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSgKICAgICAgICAgICLor7fnrYnlvoXlm77niYfkuIrkvKDmiJDlip/jgILlpoLmnpzlh7rnjrDnvZHnu5zpl67popjvvIzor7fliLfmlrDpobXpnaLlubbph43mlrDkuIrkvKDvvIEiCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coYXJyKTsKICAgICAgdGhpcy4kZW1pdCgic3VjY2Vzc0NCSyIsIGFycik7CiAgICAgIHRoaXMubGlzdE9iaiA9IHt9OwogICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOwogICAgfSwKICAgIGhhbmRsZVN1Y2Nlc3MocmVzcG9uc2UsIGZpbGUpIHsKICAgICAgY29uc3QgdWlkID0gZmlsZS51aWQ7CiAgICAgIGNvbnN0IG9iaktleUFyciA9IE9iamVjdC5rZXlzKHRoaXMubGlzdE9iaik7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBvYmpLZXlBcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5saXN0T2JqW29iaktleUFycltpXV0udWlkID09PSB1aWQpIHsKICAgICAgICAgIHRoaXMubGlzdE9ialtvYmpLZXlBcnJbaV1dLnVybCA9IHJlc3BvbnNlOwogICAgICAgICAgdGhpcy5saXN0T2JqW29iaktleUFycltpXV0uaGFzU3VjY2VzcyA9IHRydWU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaGFuZGxlUmVtb3ZlKGZpbGUpIHsKICAgICAgY29uc3QgZmlsZUxpc3QgPSB0aGlzLiRyZWZzLnVwbG9hZEltZy51cGxvYWRGaWxlczsKICAgICAgY29uc3QgaW5kZXggPSBmaWxlTGlzdC5maW5kSW5kZXgoKGZpbGVJdGVtKSA9PiB7CiAgICAgICAgcmV0dXJuIGZpbGVJdGVtLnVpZCA9PT0gZmlsZS51aWQ7CiAgICAgIH0pOwogICAgICBmaWxlTGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICBjb25zdCB1aWQgPSBmaWxlLnVpZDsKICAgICAgZGVsZXRlIHRoaXMubGlzdE9ialt1aWRdOwogICAgfSwKICAgIGJlZm9yZVVwbG9hZChmaWxlKSB7CiAgICAgIGNvbnN0IF9zZWxmID0gdGhpczsKICAgICAgY29uc3QgX1VSTCA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTDsKICAgICAgY29uc3QgZmlsZU5hbWUgPSBmaWxlLnVpZDsKICAgICAgdGhpcy5saXN0T2JqW2ZpbGVOYW1lXSA9IHt9OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgIGltZy5zcmMgPSBfVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKTsKICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBfc2VsZi5saXN0T2JqW2ZpbGVOYW1lXSA9IHsKICAgICAgICAgICAgaGFzU3VjY2VzczogZmFsc2UsCiAgICAgICAgICAgIHVpZDogZmlsZS51aWQsCiAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LAogICAgICAgICAgfTsKICAgICAgICB9OwogICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["EditorImage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditorImage.vue","sourceRoot":"src/components/Tinymce/components","sourcesContent":["<template>\n  <div class=\"upload-container\">\n    <el-button\n      :style=\"{ background: color, borderColor: color }\"\n      icon=\"el-icon-upload\"\n      size=\"mini\"\n      type=\"primary\"\n      @click=\"dialogVisible = true\"\n    >\n      上传图片\n    </el-button>\n    <el-dialog :visible.sync=\"dialogVisible\" :append-to-body=\"true\">\n      <el-upload\n        ref=\"uploadImg\"\n        :multiple=\"true\"\n        :file-list=\"fileList\"\n        :show-file-list=\"true\"\n        :before-upload=\"beforeUpload\"\n        class=\"editor-slide-upload\"\n        :action=\"qiniuHost\"\n        list-type=\"picture-card\"\n        :http-request=\"httpRequestFn\"\n      >\n        <div slot=\"file\" slot-scope=\"{ file }\" class=\"show_img_box\">\n          <img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\" />\n          <div class=\"progress\">\n            <span\n              v-if=\"parseInt(fileProgress[file.uid]) >= 100\"\n              class=\"delete_icon\"\n              @click=\"handleRemove(file)\"\n            >\n              <i class=\"el-icon-delete\" />\n            </span>\n            <el-progress\n              v-if=\"parseInt(fileProgress[file.uid]) < 100\"\n              style=\"color: #FFFFFF;\"\n              type=\"circle\"\n              :percentage=\"parseInt(fileProgress[file.uid])\"\n            />\n          </div>\n        </div>\n        <i slot=\"default\" class=\"el-icon-plus\" />\n      </el-upload>\n      <el-button @click=\"dialogVisible = false\">\n        取消\n      </el-button>\n      <el-button type=\"primary\" @click=\"handleSubmit\">\n        确认\n      </el-button>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n// import { getToken } from 'api/qiniu'\nimport { qiniuHost } from \"@/webConfig.js\";\nimport { mapGetters } from \"vuex\";\nimport { UploadImg } from \"@/api/system.js\";\nexport default {\n  name: \"EditorSlideUpload\",\n  props: {\n    color: {\n      type: String,\n      default: \"#1890ff\",\n    },\n  },\n  data() {\n    return {\n      qiniuHost: qiniuHost,\n      dialogVisible: false,\n      listObj: {},\n      fileList: [],\n    };\n  },\n  computed: {\n    ...mapGetters([\"token\"]),\n    fileProgress() {\n      return this.$store.state.user.fileProgress;\n    },\n  },\n  methods: {\n    checkAllSuccess() {\n      return Object.keys(this.listObj).every(\n        (item) => this.listObj[item].hasSuccess\n      );\n    },\n    httpRequestFn(data) {\n      const loading = this.$loading({ text: \"上传中..\" });\n      const formData = new FormData();\n      formData.append(\"file\", data.file);\n      UploadImg(formData)\n        .then((res) => {\n          console.log(res);\n          this.$emit(\"uploadSuc\", res);\n          this.handleSuccess(res.data, data.file);\n          if (this.checkAllSuccess()) {\n            loading.close();\n            this.$message({\n              showClose: true,\n              message: \"图片上传成功！点击确认插入文本编辑器\",\n              type: \"success\",\n            });\n          }\n        })\n        .catch(() => {\n          this.$message({\n            showClose: true,\n            message: \"文件上传失败！\",\n            type: \"warning\",\n          });\n          loading.close();\n        });\n    },\n    handleSubmit() {\n      const arr = Object.keys(this.listObj).map((v) => this.listObj[v]);\n      if (!this.checkAllSuccess()) {\n        this.$message(\n          \"请等待图片上传成功。如果出现网络问题，请刷新页面并重新上传！\"\n        );\n        return;\n      }\n      console.log(arr);\n      this.$emit(\"successCBK\", arr);\n      this.listObj = {};\n      this.fileList = [];\n      this.dialogVisible = false;\n    },\n    handleSuccess(response, file) {\n      const uid = file.uid;\n      const objKeyArr = Object.keys(this.listObj);\n      for (let i = 0, len = objKeyArr.length; i < len; i++) {\n        if (this.listObj[objKeyArr[i]].uid === uid) {\n          this.listObj[objKeyArr[i]].url = response;\n          this.listObj[objKeyArr[i]].hasSuccess = true;\n          return;\n        }\n      }\n    },\n    handleRemove(file) {\n      const fileList = this.$refs.uploadImg.uploadFiles;\n      const index = fileList.findIndex((fileItem) => {\n        return fileItem.uid === file.uid;\n      });\n      fileList.splice(index, 1);\n      const uid = file.uid;\n      delete this.listObj[uid];\n    },\n    beforeUpload(file) {\n      const _self = this;\n      const _URL = window.URL || window.webkitURL;\n      const fileName = file.uid;\n      this.listObj[fileName] = {};\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = _URL.createObjectURL(file);\n        img.onload = function() {\n          _self.listObj[fileName] = {\n            hasSuccess: false,\n            uid: file.uid,\n            width: this.width,\n            height: this.height,\n          };\n        };\n        resolve(true);\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.editor-slide-upload {\n  margin-bottom: 20px;\n  ::v-deep .el-upload--picture-card {\n    width: 100%;\n  }\n}\n.show_img_box {\n  width: 148px;\n  height: 148px;\n  position: relative;\n  .progress {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    background: rgba(0, 0, 0, 0.7);\n    .el-progress__text {\n      color: #ffffff;\n    }\n  }\n  .delete_icon {\n    .el-icon-delete {\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-top: -10px;\n      margin-left: -10px;\n      color: #ffffff;\n      font-size: 20px;\n      z-index: 2;\n      cursor: pointer;\n    }\n  }\n}\n</style>\n"]}]}