{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\loonUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\loonUpload.vue","mtime":1669707457667},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHV1aWQgfSBmcm9tICJ1dWlkdjQiOwppbXBvcnQgeyBVcGxvYWRJbWcgfSBmcm9tICJAL2FwaS9zeXN0ZW0uanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImxvb24tdXBsb2FkIiwKICBwcm9wczogWyJ0eXBlIiwgImZvbGRlciIsICJsaW1pdCIsICJzaXplIl0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlkOiAiIiwKICAgICAgLy/mmoLlrZjpmJ/liJcKICAgICAgdXBsb2FkTGlzdDogW10sCiAgICAgIC8v5bey5a2Y6Zif5YiXCiAgICAgIHVwbG9hZGVkTGlzdDogW10sCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgdXBsb2FkKCkgewogICAgICB0aGlzLiRyZWZzW3RoaXMuaWRdLmNsaWNrKCk7CiAgICB9LAogICAgaXNOdWxsKCkgewogICAgICByZXR1cm4gdGhpcy51cGxvYWRMaXN0Lmxlbmd0aCArIHRoaXMudXBsb2FkZWRMaXN0Lmxlbmd0aCA9PSAwOwogICAgfSwKICAgIGFzeW5jIHVwbG9hZEZpbGUoKSB7CiAgICAgIC8vIGxvYWRpbmcKICAgICAgY29uc3QgbG9hZGluZyA9IHRoaXMuJGxvYWRpbmcoeyB0ZXh0OiAi5LiK5Lyg5LitLi4iIH0pOwoKICAgICAgLy/lt7LkuIrkvKDmlbDmja4KICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICB0aGlzLnVwbG9hZGVkTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgcmVzdWx0LnB1c2goaXRlbS51cmwpOwogICAgICB9KTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnVwbG9hZExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoKICAgICAgICBmb3JtRGF0YS5hcHBlbmQoImZpbGUiLCB0aGlzLnVwbG9hZExpc3RbaV0uZmlsZSk7CiAgICAgICAgYXdhaXQgVXBsb2FkSW1nKGZvcm1EYXRhKQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICByZXN1bHQucHVzaChyZXMuZGF0YSk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgICAgc2hvd0Nsb3NlOiB0cnVlLAogICAgICAgICAgICAgIG1lc3NhZ2U6IGDnrKwke2kgKyAxfeS7veaWh+S7tuS4iuS8oOWksei0pe+8gWAsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIuS4iuS8oOWksei0pSIpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIHJlc2V0KHVybEFycmF5ID0gW10pIHsKICAgICAgdGhpcy51cGxvYWRMaXN0ID0gW107CiAgICAgIHRoaXMudXBsb2FkZWRMaXN0ID0gdXJsQXJyYXk7CiAgICAgIHRoaXMuJGZvcmNlVXBkYXRlKCk7CiAgICB9LAogICAgZmlsZUNoYW5nZSgpIHsKICAgICAgY29uc3QgdXBsb2FkTGVuZ3RoID0gdGhpcy51cGxvYWRMaXN0Lmxlbmd0aDsKICAgICAgY29uc3QgdXBsb2FkZWRMZW5ndGggPSB0aGlzLnVwbG9hZGVkTGlzdC5sZW5ndGg7CiAgICAgIGNvbnN0IGNhblVwbG9hZENvdW50ID0gdGhpcy5saW1pdCAtIHVwbG9hZExlbmd0aCAtIHVwbG9hZGVkTGVuZ3RoOwoKICAgICAgY29uc3QgZmlsZXMgPSB0aGlzLiRyZWZzW3RoaXMuaWRdLmZpbGVzOwogICAgICBjb25zdCBmaWxlTGVuZ3RoID0gdGhpcy4kcmVmc1t0aGlzLmlkXS5maWxlcy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZUxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPiBjYW5VcGxvYWRDb3VudCAtIDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuc2l6ZSA9PSB1bmRlZmluZWQgfHwgZmlsZXNbaV0uc2l6ZSA8PSB0aGlzLnNpemUpIHsKICAgICAgICAgIC8v55Sf5oiQ6aKE6KeI5Zu+54mHCiAgICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlc1tpXSk7CiAgICAgICAgICB0aGlzLnVwbG9hZExpc3QucHVzaCh7IHVybDogdXJsLCBmaWxlOiBmaWxlc1tpXSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5paH5Lu25aSn5bCP6LaF6L+HIiArIHRoaXMuc2l6ZSAvIDEwMjQgLyAxMDI0ICsgIk0iKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8g6L+Z6KGM5Luj56CB5b6I5qC45b+D77yM5rKh5pyJ6L+Z6KGM5Lya5Ye6546w5LiA5LiqYnVn77yM5peg5rOV6YeN5aSN5LiK5Lyg5ZCM5LiA5byg5Zu+54mHCiAgICAgIHRoaXMuJHJlZnNbdGhpcy5pZF0udmFsdWUgPSAiIjsKICAgIH0sCiAgICByZW1vdmUodXJsKSB7CiAgICAgIHRoaXMudXBsb2FkTGlzdCA9IHRoaXMudXBsb2FkTGlzdC5maWx0ZXIoKGl0ZW0pID0+IHsKICAgICAgICBpZiAoaXRlbS51cmwgIT0gdXJsKSB7CiAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnVwbG9hZGVkTGlzdCA9IHRoaXMudXBsb2FkZWRMaXN0LmZpbHRlcigoaXRlbSkgPT4gewogICAgICAgIGlmIChpdGVtLnVybCAhPSB1cmwpIHsKICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8vIOe7k+adn+S6hua4hemZpOaOieS4jeW/heimgeeahOi1hOa6kAogICAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogICAgfSwKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmlkID0gdXVpZCgpOwogIH0sCn07Cg=="},{"version":3,"sources":["loonUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"loonUpload.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"content\">\n    <input\n      type=\"file\"\n      id=\"file\"\n      :ref=\"id\"\n      :accept=\"type\"\n      multiple=\"multiple\"\n      @change=\"fileChange\"\n    />\n\n    <div\n      id=\"add\"\n      v-show=\"uploadList.length + uploadedList.length < limit\"\n      @click=\"upload\"\n    >\n      <i class=\"el-icon-plus avatar-uploader-icon\"></i>\n    </div>\n    <div class=\"uploaded\" v-for=\"item in uploadedList\" :key=\"item.url\">\n      <!-- image/png,image/jpeg / image.*-->\n      <img\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        :src=\"item.url\"\n      />\n      <div\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_img\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- audio/mpeg,audio/ogg,audio/wav -->\n      <audio\n        v-show=\"type.indexOf('audio') > -1\"\n        :src=\"item.url\"\n        controls\n      ></audio>\n      <div\n        v-show=\"type.indexOf('audio') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_aduio\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- video/mp4,video/webm,video/ogg -->\n      <video\n        v-show=\"type.indexOf('video') > -1\"\n        :src=\"item.url\"\n        controls\n      ></video>\n      <i\n        class=\"el-icon-delete delete_video\"\n        v-show=\"type.indexOf('video') > -1\"\n        @click=\"remove(item.url)\"\n      ></i>\n      <!-- text/plain,text/html -->\n      <el-link\n        :href=\"item.url\"\n        v-show=\"type.indexOf('text') > -1\"\n        type=\"success\"\n        target=\"_Blank\"\n      >\n        {{ item.url.slice(item.url.lastIndexOf(\"/\") + 1) }}\n      </el-link>\n      <i\n        v-show=\"type.indexOf('text') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"el-icon-delete\"\n      ></i>\n    </div>\n\n    <div class=\"upload\" v-for=\"item in uploadList\" :key=\"item.url\">\n      <!-- image/png,image/jpeg / image.*-->\n      <img\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        :src=\"item.url\"\n      />\n      <div\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_img\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- audio/mpeg,audio/ogg,audio/wav -->\n      <audio\n        v-show=\"type.indexOf('audio') > -1\"\n        :src=\"item.url\"\n        controls\n      ></audio>\n      <div\n        v-show=\"type.indexOf('audio') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_aduio\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- video/mp4,video/webm,video/ogg -->\n      <video\n        v-show=\"type.indexOf('video') > -1\"\n        :src=\"item.url\"\n        controls\n      ></video>\n      <i\n        class=\"el-icon-delete delete_video\"\n        v-show=\"type.indexOf('video') > -1\"\n        @click=\"remove(item.url)\"\n      ></i>\n      <!-- text/plain,text/html -->\n      <el-link\n        :href=\"item.url\"\n        v-show=\"type.indexOf('text') > -1\"\n        type=\"primary\"\n        target=\"_Blank\"\n      >\n        <!-- {{ item.url.slice(item.url.lastIndexOf('/')+1) }} -->\n        {{ item.file.name }}\n      </el-link>\n      <i\n        v-show=\"type.indexOf('text') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"el-icon-delete\"\n      ></i>\n    </div>\n  </div>\n</template>\n<script>\nimport { uuid } from \"uuidv4\";\nimport { UploadImg } from \"@/api/system.js\";\nexport default {\n  name: \"loon-upload\",\n  props: [\"type\", \"folder\", \"limit\", \"size\"],\n  data() {\n    return {\n      id: \"\",\n      //暂存队列\n      uploadList: [],\n      //已存队列\n      uploadedList: [],\n    };\n  },\n  methods: {\n    upload() {\n      this.$refs[this.id].click();\n    },\n    isNull() {\n      return this.uploadList.length + this.uploadedList.length == 0;\n    },\n    async uploadFile() {\n      // loading\n      const loading = this.$loading({ text: \"上传中..\" });\n\n      //已上传数据\n      var result = [];\n      this.uploadedList.forEach((item) => {\n        result.push(item.url);\n      });\n      for (let i = 0; i < this.uploadList.length; i++) {\n        const formData = new FormData();\n\n        formData.append(\"file\", this.uploadList[i].file);\n        await UploadImg(formData)\n          .then((res) => {\n            result.push(res.data);\n          })\n          .catch(() => {\n            this.$message({\n              showClose: true,\n              message: `第${i + 1}份文件上传失败！`,\n              type: \"warning\",\n            });\n            loading.close();\n            throw new Error(\"上传失败\");\n          });\n      }\n      loading.close();\n      return result;\n    },\n    reset(urlArray = []) {\n      this.uploadList = [];\n      this.uploadedList = urlArray;\n      this.$forceUpdate();\n    },\n    fileChange() {\n      const uploadLength = this.uploadList.length;\n      const uploadedLength = this.uploadedList.length;\n      const canUploadCount = this.limit - uploadLength - uploadedLength;\n\n      const files = this.$refs[this.id].files;\n      const fileLength = this.$refs[this.id].files.length;\n      for (let i = 0; i < fileLength; i++) {\n        if (i > canUploadCount - 1) {\n          return;\n        }\n        if (this.size == undefined || files[i].size <= this.size) {\n          //生成预览图片\n          const url = window.URL.createObjectURL(files[i]);\n          this.uploadList.push({ url: url, file: files[i] });\n        } else {\n          this.$message.error(\"文件大小超过\" + this.size / 1024 / 1024 + \"M\");\n        }\n      }\n      // 这行代码很核心，没有这行会出现一个bug，无法重复上传同一张图片\n      this.$refs[this.id].value = \"\";\n    },\n    remove(url) {\n      this.uploadList = this.uploadList.filter((item) => {\n        if (item.url != url) {\n          return item;\n        }\n      });\n      this.uploadedList = this.uploadedList.filter((item) => {\n        if (item.url != url) {\n          return item;\n        }\n      });\n      // 结束了清除掉不必要的资源\n      window.URL.revokeObjectURL(url);\n    },\n  },\n  mounted() {\n    this.id = uuid();\n  },\n};\n</script>\n<style lang=\"less\" scoped>\n#content {\n  width: max-content;\n  height: max-content;\n  #file {\n    display: none;\n  }\n  #add {\n    width: 100px;\n    height: 100px;\n    line-height: 100px;\n    border-radius: 10px;\n    text-align: center;\n    margin-left: 2px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    border: 1px dashed #c0ccda;\n    margin: 5px;\n  }\n  #add:hover {\n    color: #409eff;\n    border-color: #409eff;\n  }\n  img {\n    width: 100px;\n    height: 100px;\n    margin: 5px;\n    border-radius: 10px;\n  }\n  video {\n    min-width: 200px;\n    max-width: 200px;\n    height: 150px;\n    border: 1px solid;\n    border-radius: 8px;\n  }\n  .delete_img {\n    width: 100px;\n    height: 100px;\n    margin: 5px;\n    display: none;\n  }\n  .delete_aduio {\n    line-height: 54px;\n  }\n  .delete_video {\n    height: 20px;\n    position: relative;\n    right: 20px;\n    top: 4px;\n  }\n  .upload:hover > .delete_img {\n    display: block;\n    color: #fff;\n    width: 100px;\n    height: 100px;\n    text-align: center;\n    line-height: 100px;\n    position: absolute;\n    background: rgba(0, 0, 0, 0.5);\n  }\n  .uploaded:hover > .delete_img {\n    display: block;\n    color: #fff;\n    width: 100px;\n    height: 100px;\n    text-align: center;\n    line-height: 100px;\n    position: absolute;\n    background: rgba(0, 0, 0, 0.5);\n  }\n  .upload {\n    display: flex;\n    width: max-content;\n    height: max-content;\n  }\n  .uploaded {\n    display: flex;\n    width: max-content;\n    height: max-content;\n  }\n}\n</style>\n"]}]}