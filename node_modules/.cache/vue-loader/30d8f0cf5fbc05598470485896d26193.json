{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\views\\system\\setup-role\\index.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\views\\system\\setup-role\\index.vue","mtime":1669258939335},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\@vue\\cli-service\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouY29udGVudF9ib3h7CiAgLmVsLXRyZWUtbm9kZXsKICAgIG1hcmdpbjogMTVweCAwOwogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2SA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/system/setup-role","sourcesContent":["<template>\n  <div class=\"content_box\">\n    <first-title title=\"角色管理\" />\n    <div class=\"select_view\">\n      <el-button type=\"primary\" @click=\"addDataFn\"><i class=\"el-icon-plus\" />添加角色</el-button>\n      <span class=\"mg_l15\" style=\"color: #F56C6C;\">注意：“修改”和“添加”系统角色项目后需要点击右侧“提交编辑”按钮才会生效哦</span>\n    </div>\n    <el-table\n      v-loading=\"dataConfig.loading\"\n      border\n      :data=\"dataList\"\n      class=\"list\"\n    >\n      <el-table-column label=\"角色ID\" width=\"70px\">\n        <template slot-scope=\"scope\">\n          <span v-if=\"scope.row.id\">{{ scope.row.id }}</span>\n          <span v-if=\"!scope.row.id\" class=\"delete_icon\" @click=\"deleteAddFn(scope.$index)\"><i class=\"el-icon-delete\" /></span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"角色名称\">\n        <template slot-scope=\"scope\">\n          <el-input v-model=\"scope.row.name\" placeholder=\"请输入角色名称\" />\n        </template>\n      </el-table-column>\n      <el-table-column label=\"角色描述\">\n        <template slot-scope=\"scope\">\n          <el-input v-model=\"scope.row.description\" placeholder=\"请输入角色描述\" />\n        </template>\n      </el-table-column>\n      <el-table-column label=\"角色权限菜单\" style=\"width: 100px;\">\n        <template slot-scope=\"scope\">\n          <!-- <el-input v-model=\"scope.row.menuIds\" style=\"width: 400px;\" placeholder=\"请输入角色权限菜单ID或点击右侧按钮选择\" /> -->\n          <el-tooltip class=\"item\" effect=\"dark\" placement=\"bottom\">\n            <div slot=\"content\" style=\"width: 400px;line-height: 1.6em;\">\n              <p style=\"margin-bottom: 10px;\">已选权限ID</p>\n              <p>{{ scope.row.menuIds && scope.row.menuIds.join(',') }}</p>\n            </div>\n            <el-button type=\"primary\" plain=\"\" size=\"small\" @click=\"checkMenuFn(scope)\">点击选择菜单</el-button>\n          </el-tooltip>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"状态(禁用/启用)\">\n        <template slot-scope=\"scope\">\n          <el-switch v-model=\"scope.row.status\" :disabled=\"scope.row.id == ''\" @change=\"statusChangeFn($event,scope.$index)\" />\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"240px\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click=\"editDataFn(scope.row)\">提交编辑</el-button>\n          <el-button v-if=\"scope.row.id\" type=\"danger\" size=\"small\" @click=\"deleteFn(scope)\"><i class=\"el-icon-delete\" />删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <div class=\"el_pagination\">\n      <el-pagination\n        background\n        layout=\"prev, pager, next,total,sizes\"\n        :current-page=\"dataConfig.pageNo\"\n        :total=\"dataConfig.total\"\n        :page-sizes=\"[20, 30, 40, 50]\"\n        @current-change=\"currentChangeFn\"\n        @size-change=\"handleSizeChange\"\n      />\n    </div>\n    <el-dialog\n      title=\"权限菜单配置\"\n      :visible.sync=\"dialogVisible\"\n      width=\"50%\"\n    >\n      <el-tree\n        ref=\"tree\"\n        :props=\"defaultProps\"\n        :data=\"treeList\"\n        :check-strictly=\"true\"\n        node-key=\"id\"\n        :default-checked-keys=\"[]\"\n        show-checkbox\n        @check-change=\"checkChangeFn\"\n      />\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"getCheckedKeysFn\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { roleDetailFn, addOrUpdateRoleFn, menuTreeListFn, roleListFn, roleRemoveFn, handleRoleStatusFn } from '@/api/system.js'\nimport { mapGetters, mapActions } from 'vuex'\nexport default {\n  name: 'SetupRole',\n  data() {\n    return {\n      dataList: [],\n      dialogVisible: false,\n      treeList: [],\n      checkedRowIndex: 0,\n      defaultProps: {\n        label: (data, node) => {\n          return `${data.name}(ID:${data.id})`\n        },\n        children: 'children'\n      },\n      editData: {\n        'description': '',\n        'id': '',\n        'isAdmin': '',\n        'menuIds': [],\n        'name': '',\n        'status': true\n      },\n      dataConfig: {\n        'pageNo': 1,\n        'pageSize': 50,\n        'total': 0,\n        'loading': true\n      }\n    }\n  },\n  beforeMount() {\n    this['user/actionMenulist']({ menuType: -1 }).then(() => {\n      this.roleListFn()\n    })\n  },\n  computed: {\n    ...mapGetters(['menuTreeList'])\n  },\n  methods: {\n    ...mapActions(['user/actionMenulist']),\n    checkChangeFn(data, selfChecked, chlidChecked) {\n      if (selfChecked) {\n        console.log(data.parentId)\n        if (data.parentId != 0) {\n          this.$refs.tree.setChecked(data.parentId, true)\n        }\n      } else {\n        this.checkChildren(data)\n      }\n    },\n    checkChildren(data) {\n      data.children.forEach((item) => {\n        this.$refs.tree.setChecked(item.id, false)\n        if (item.children && item.children.length > 0) {\n          this.checkChildren(item)\n        }\n      })\n    },\n    getCheckedKeysFn() {\n      const ids = this.$refs.tree.getCheckedKeys()\n      this.dataList[this.checkedRowIndex].menuIds.splice(0, this.dataList[this.checkedRowIndex].menuIds.length, ...ids)\n      this.dialogVisible = false\n    },\n    checkMenuFn(scop) {\n      this.dialogVisible = true\n      this.checkedRowIndex = scop.$index\n      this.treeList.splice(0, this.treeList.length, ...scop.row.treeList)\n      this.$nextTick(() => {\n        this.$refs.tree.setCheckedKeys(scop.row.menuIds)\n      })\n    },\n    handleSizeChange(val) {\n      this.dataConfig.pageSize = val\n      this.roleListFn()\n    },\n    currentChangeFn(pageNo) {\n      this.dataConfig.pageNo = pageNo\n      this.roleListFn()\n    },\n    addDataFn() {\n      this.editData = {\n        'description': '',\n        'id': '',\n        'isAdmin': '',\n        'menuIds': [],\n        'name': '',\n        'status': true\n      }\n      this.dataList.unshift(Object.assign({}, this.editData, { treeList: this.menuTreeList }))\n    },\n    deleteAddFn(index) {\n      this.dataList.splice(index, 1)\n    },\n    statusChangeFn(val, index) {\n      console.log(val)\n      handleRoleStatusFn({\n        id: this.dataList[index].id,\n        status: val ? 1 : 0\n      }).then((res) => {\n        if (res.code == '000') {\n          this.$message({\n            showClose: true,\n            message: '操作成功！',\n            type: 'success'\n          })\n        } else {\n          this.dataList[index].status = !val\n        }\n      }).catch(() => {\n        this.dataList[index].status = !val\n      })\n    },\n    editDataFn(val) {\n      if (!val.name) {\n        this.$message({\n          showClose: true,\n          message: '请填写角色名称！',\n          type: 'warning'\n        })\n        return\n      }\n      if (val.menuIds.length == 0) {\n        this.$message({\n          showClose: true,\n          message: '请选择角色权限菜单！',\n          type: 'warning'\n        })\n        return\n      }\n      addOrUpdateRoleFn({\n        'description': val.description,\n        'id': val.id,\n        'isAdmin': val.isAdmin,\n        'menuIds': val.menuIds.slice(),\n        'name': val.name\n      }).then((res) => {\n        const resData = this.resDataFn(res)\n        if (resData == '000') {\n          this.$message({\n            showClose: true,\n            message: '操作成功！',\n            type: 'success'\n          })\n          this.roleListFn()\n        }\n      })\n    },\n    deleteFn(scope) {\n      this.deleteAlert().then(() => {\n        const res = roleRemoveFn({ id: scope.row.id })\n        return res\n      }).then((res) => {\n        const resData = this.resDataFn(res)\n        if (resData == '000') {\n          this.$message({\n            showClose: true,\n            message: '操作成功！',\n            type: 'success'\n          })\n          this.dataList.splice(scope.$index, 1)\n        }\n      })\n    },\n    menuRouteKList(list) {\n      const resArr = []\n      const forEachArrFn = function(arr) {\n        arr.forEach((item) => {\n          item.id && resArr.push(item.id)\n          if (Object.prototype.toString.call(item.children) == '[object Array]') {\n            forEachArrFn(item.children)\n          }\n        })\n      }\n      forEachArrFn(list)\n      return resArr\n    },\n    menuTreeListFn() {\n      this.dataList.forEach((item, index) => {\n        item.status = item.status == 1\n        if (item.id) {\n          menuTreeListFn({ id: item.id }).then((res) => {\n            const resData = this.resDataFn(res)\n            this.$set(this.dataList, index, Object.assign({}, item, {\n              menuIds: this.menuRouteKList(resData)\n            }))\n          })\n        }\n      })\n    },\n    roleListFn() {\n      roleListFn({\n        pageNo: this.dataConfig.pageNo,\n        pageSize: this.dataConfig.pageSize\n      }).then((res) => {\n        const resData = this.resDataFn(res)\n        resData.records.forEach((item) => {\n          item.treeList = this.menuTreeList\n        })\n        this.dataList.splice(0, this.dataList.length, ...resData.records)\n        this.dataConfig.total = resData.total\n        console.log(this.dataList)\n        this.menuTreeListFn()\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n  .content_box{\n    .el-tree-node{\n      margin: 15px 0;\n    }\n  }\n</style>\n"]}]}