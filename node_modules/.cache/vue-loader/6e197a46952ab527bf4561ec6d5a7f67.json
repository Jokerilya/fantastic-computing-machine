{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\Tinymce\\components\\EditorImage.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\Tinymce\\components\\EditorImage.vue","mtime":1670046758181},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\@vue\\cli-service\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmVkaXRvci1zbGlkZS11cGxvYWQgewogIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgOjp2LWRlZXAgLmVsLXVwbG9hZC0tcGljdHVyZS1jYXJkIHsKICAgIHdpZHRoOiAxMDAlOwogIH0KfQouc2hvd19pbWdfYm94IHsKICB3aWR0aDogMTQ4cHg7CiAgaGVpZ2h0OiAxNDhweDsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgLnByb2dyZXNzIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgbGVmdDogMDsKICAgIHotaW5kZXg6IDE7CiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuNyk7CiAgICAuZWwtcHJvZ3Jlc3NfX3RleHQgewogICAgICBjb2xvcjogI2ZmZmZmZjsKICAgIH0KICB9CiAgLmRlbGV0ZV9pY29uIHsKICAgIC5lbC1pY29uLWRlbGV0ZSB7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgdG9wOiA1MCU7CiAgICAgIGxlZnQ6IDUwJTsKICAgICAgbWFyZ2luLXRvcDogLTEwcHg7CiAgICAgIG1hcmdpbi1sZWZ0OiAtMTBweDsKICAgICAgY29sb3I6ICNmZmZmZmY7CiAgICAgIGZvbnQtc2l6ZTogMjBweDsKICAgICAgei1pbmRleDogMjsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQogIH0KfQo="},{"version":3,"sources":["EditorImage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditorImage.vue","sourceRoot":"src/components/Tinymce/components","sourcesContent":["<template>\n  <div class=\"upload-container\">\n    <el-button\n      :style=\"{ background: color, borderColor: color }\"\n      icon=\"el-icon-upload\"\n      size=\"mini\"\n      type=\"primary\"\n      @click=\"dialogVisible = true\"\n    >\n      上传图片\n    </el-button>\n    <el-dialog :visible.sync=\"dialogVisible\" :append-to-body=\"true\">\n      <el-upload\n        ref=\"uploadImg\"\n        :multiple=\"true\"\n        :file-list=\"fileList\"\n        :show-file-list=\"true\"\n        :before-upload=\"beforeUpload\"\n        class=\"editor-slide-upload\"\n        :action=\"qiniuHost\"\n        list-type=\"picture-card\"\n        :http-request=\"httpRequestFn\"\n      >\n        <div slot=\"file\" slot-scope=\"{ file }\" class=\"show_img_box\">\n          <img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\" />\n          <div class=\"progress\">\n            <span\n              v-if=\"parseInt(fileProgress[file.uid]) >= 100\"\n              class=\"delete_icon\"\n              @click=\"handleRemove(file)\"\n            >\n              <i class=\"el-icon-delete\" />\n            </span>\n            <el-progress\n              v-if=\"parseInt(fileProgress[file.uid]) < 100\"\n              style=\"color: #FFFFFF;\"\n              type=\"circle\"\n              :percentage=\"parseInt(fileProgress[file.uid])\"\n            />\n          </div>\n        </div>\n        <i slot=\"default\" class=\"el-icon-plus\" />\n      </el-upload>\n      <el-button @click=\"dialogVisible = false\">\n        取消\n      </el-button>\n      <el-button type=\"primary\" @click=\"handleSubmit\">\n        确认\n      </el-button>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n// import { getToken } from 'api/qiniu'\nimport { qiniuHost } from \"@/webConfig.js\";\nimport { mapGetters } from \"vuex\";\nimport { UploadImg } from \"@/api/system.js\";\nexport default {\n  name: \"EditorSlideUpload\",\n  props: {\n    color: {\n      type: String,\n      default: \"#1890ff\",\n    },\n  },\n  data() {\n    return {\n      qiniuHost: qiniuHost,\n      dialogVisible: false,\n      listObj: {},\n      fileList: [],\n    };\n  },\n  computed: {\n    ...mapGetters([\"token\"]),\n    fileProgress() {\n      return this.$store.state.user.fileProgress;\n    },\n  },\n  methods: {\n    checkAllSuccess() {\n      return Object.keys(this.listObj).every(\n        (item) => this.listObj[item].hasSuccess\n      );\n    },\n    httpRequestFn(data) {\n      const loading = this.$loading({ text: \"上传中..\" });\n      const formData = new FormData();\n      formData.append(\"file\", data.file);\n      UploadImg(formData)\n        .then((res) => {\n          console.log(res);\n          this.$emit(\"uploadSuc\", res);\n          this.handleSuccess(res.data, data.file);\n          if (this.checkAllSuccess()) {\n            loading.close();\n            this.$message({\n              showClose: true,\n              message: \"图片上传成功！点击确认插入文本编辑器\",\n              type: \"success\",\n            });\n          }\n        })\n        .catch(() => {\n          this.$message({\n            showClose: true,\n            message: \"文件上传失败！\",\n            type: \"warning\",\n          });\n          loading.close();\n        });\n    },\n    handleSubmit() {\n      const arr = Object.keys(this.listObj).map((v) => this.listObj[v]);\n      if (!this.checkAllSuccess()) {\n        this.$message(\n          \"请等待图片上传成功。如果出现网络问题，请刷新页面并重新上传！\"\n        );\n        return;\n      }\n      console.log(arr);\n      this.$emit(\"successCBK\", arr);\n      this.listObj = {};\n      this.fileList = [];\n      this.dialogVisible = false;\n    },\n    handleSuccess(response, file) {\n      const uid = file.uid;\n      const objKeyArr = Object.keys(this.listObj);\n      for (let i = 0, len = objKeyArr.length; i < len; i++) {\n        if (this.listObj[objKeyArr[i]].uid === uid) {\n          this.listObj[objKeyArr[i]].url = response;\n          this.listObj[objKeyArr[i]].hasSuccess = true;\n          return;\n        }\n      }\n    },\n    handleRemove(file) {\n      const fileList = this.$refs.uploadImg.uploadFiles;\n      const index = fileList.findIndex((fileItem) => {\n        return fileItem.uid === file.uid;\n      });\n      fileList.splice(index, 1);\n      const uid = file.uid;\n      delete this.listObj[uid];\n    },\n    beforeUpload(file) {\n      const _self = this;\n      const _URL = window.URL || window.webkitURL;\n      const fileName = file.uid;\n      this.listObj[fileName] = {};\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = _URL.createObjectURL(file);\n        img.onload = function() {\n          _self.listObj[fileName] = {\n            hasSuccess: false,\n            uid: file.uid,\n            width: this.width,\n            height: this.height,\n          };\n        };\n        resolve(true);\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.editor-slide-upload {\n  margin-bottom: 20px;\n  ::v-deep .el-upload--picture-card {\n    width: 100%;\n  }\n}\n.show_img_box {\n  width: 148px;\n  height: 148px;\n  position: relative;\n  .progress {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    background: rgba(0, 0, 0, 0.7);\n    .el-progress__text {\n      color: #ffffff;\n    }\n  }\n  .delete_icon {\n    .el-icon-delete {\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      margin-top: -10px;\n      margin-left: -10px;\n      color: #ffffff;\n      font-size: 20px;\n      z-index: 2;\n      cursor: pointer;\n    }\n  }\n}\n</style>\n"]}]}