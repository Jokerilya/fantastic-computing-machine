{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\views\\install\\installEdit\\index.vue?vue&type=style&index=0&id=1bac726a&scoped=true&lang=css&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\views\\install\\installEdit\\index.vue","mtime":1669258939302},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\@vue\\cli-service\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLm1hbmFnZS10b3B7cGFkZGluZy1ib3R0b206IDIycHg7fQouZGVtby1ydWxlRm9ybXt3aWR0aDogNTAwcHg7fQoudGFiLXRpdGxle2Rpc3BsYXk6IGZsZXg7YWxpZ24taXRlbXM6IGNlbnRlcjtoZWlnaHQ6IDQwcHg7Zm9udC1zaXplOiAxNXB4O2ZvbnQtd2VpZ2h0OiBib2xkO3BhZGRpbmctYm90dG9tOiAxNXB4O30KLmVsLXRhZysuZWwtdGFnIHsKICAgIG1hcmdpbi1sZWZ0OiAxMHB4Owp9Ci50YWItY29udGVudC10YWd7ZGlzcGxheTogZmxleDthbGlnbi1pdGVtczogY2VudGVyO21hcmdpbi1ib3R0b206IDE2cHg7fQovKiAgKi8KLnJlbGF0aW9uLWxpc3R7ZGlzcGxheTogZmxleDtmbGV4LXdyYXA6IHdyYXA7fQoucmVsYXRpb24taXRlbXtkaXNwbGF5OiBmbGV4O2ZsZXgtZGlyZWN0aW9uOiBjb2x1bW47YWxpZ24taXRlbXM6IGNlbnRlcjt3aWR0aDogMTIwcHg7cG9zaXRpb246IHJlbGF0aXZlO21hcmdpbjogMCAxMHB4IDEwcHggMDt9Ci5yZWxhdGlvbi1pdGVtOm50aC1jaGlsZCg2bil7bWFyZ2luLXJpZ2h0OiAwO30KLnJlbGF0aW9uLWl0ZW0+aXtmb250LXNpemU6IDIwcHg7cG9zaXRpb246IGFic29sdXRlO3JpZ2h0OiAwO3RvcDogMDt6LWluZGV4OiAxMDtjdXJzb3I6IHBvaW50ZXI7cGFkZGluZzogNHB4O30KLnJlbGF0aW9uLWl0ZW0+aTpob3ZlcntvcGFjaXR5OiAuODt9Ci5yZWxhdGlvbi1pdGVtPnNwYW57bWFyZ2luLXRvcDogNnB4O2NvbG9yOiAjMzMzO2ZvbnQtd2VpZ2h0OiBub3JtYWw7Zm9udC1zaXplOiAxMnB4O2Rpc3BsYXk6IC13ZWJraXQtYm94Oy13ZWJraXQtYm94LW9yaWVudDogdmVydGljYWw7LXdlYmtpdC1saW5lLWNsYW1wOiAyO292ZXJmbG93OiBoaWRkZW47fQoucmVsYXRpb24taXRlbT5zcGFuOm50aC1vZi10eXBlKDIpe2ZvbnQtc2l6ZTogMTJweDtjb2xvcjogIzY2Njtmb250LXdlaWdodDogbm9ybWFsO30KLnJlbGF0aW9uLWl0ZW0+c3BhbjpudGgtb2YtdHlwZSgzKXtmb250LXNpemU6IDEycHg7Y29sb3I6IHJlZDtmb250LXdlaWdodDogbm9ybWFsO30KLnJlbGF0aW9uLWl0ZW06aG92ZXIgaXtjb2xvcjogcmVkO30K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6jBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/install/installEdit","sourcesContent":["<template>\n\t<div class=\"app-container\">\n\t\t<div class=\"manage-top\">\n\t\t\t<el-page-header @back=\"goBack\" content=\"添加/编辑装机\"></el-page-header>\n\t\t</div>\n\t\t<div style=\"height: 2px;\"></div>\n\t\t<div class=\"manage-top\">\n\t\t\t<el-tabs v-model=\"tabSelectVal\">\n\t\t\t    <el-tab-pane :label=\"item.name\" :name=\"item.lable\" v-for=\"(item,index) in tabs\" :key=\"item.lable\"></el-tab-pane>\n\t\t\t</el-tabs>\n\t\t\t<div class=\"tab-content\" v-show=\"tabSelectVal === 'first'\">\n\t\t\t\t<div class=\"tab-title\">\n\t\t\t\t\t<span>商品信息</span>\n\t\t\t\t</div>\n\t\t\t\t<el-form :model=\"queryData\" :rules=\"firstRules\" ref=\"ruleForm\" label-position=\"right\" label-width=\"160px\" class=\"demo-ruleForm\">\n\t\t\t\t\t<el-form-item label=\"商品名称\" prop=\"name\">\n\t\t\t\t\t\t<el-input v-model=\"queryData.name\" placeholder=\"请输入商品名称\"></el-input>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"装机介绍\" >\n\t\t\t\t\t\t<el-input type=\"textarea\" v-model=\"queryData.descVal\" rows=\"3\" resize=\"none\" placeholder=\"请输入装机介绍\"></el-input>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"装机封面图\" prop=\"img\">\n\t\t\t\t\t\t<upload-img width=\"80px\" height=\"80px\" :img=\"queryData.img\" @uploadSuc=\"uploadSucFn\"/>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"装机轮播图\" prop=\"carouselImg\">\n\t\t\t\t\t\t<upload-imgs :imgs=\"queryData.carouselImg\" @uploadSuc=\"uploadImgsSucFn\" @deleteImg=\"deleteImgFn\"/>\n\t\t\t\t\t\t<!-- <span style=\"color: gray;\">只能上传jpg/png格式图片</span> -->\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"小程序装机轮播图\" prop=\"appletCarouselImg\">\n\t\t\t\t\t\t<upload-imgs :imgs=\"queryData.appletCarouselImg\" @uploadSuc=\"uploadappletImgsSucFn\" @deleteImg=\"deleteappletImgFn\"/>\n\t\t\t\t\t\t<!-- <span style=\"color: gray;\">只能上传jpg/png格式图片</span> -->\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"产品类型\">\n\t\t\t\t\t\t<el-radio-group v-model=\"queryData.type\" @change=\"installTypeChange\">\n\t\t\t\t\t\t    <el-radio :label=\"1\">整机</el-radio>\n\t\t\t\t\t\t    <el-radio :label=\"2\">加工中心</el-radio>\n\t\t\t\t\t\t</el-radio-group>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"装机型号\" prop=\"modelId\">\n\t\t\t\t\t\t<el-select v-model=\"queryData.modelId\" filterable placeholder=\"请选择\" style=\"width: 250px;\">\n\t\t\t\t\t\t    <el-option v-for=\"item in installSubType\" :key=\"item.id\" :label=\"item.modelName\" :value=\"item.id\"></el-option>\n\t\t\t\t\t\t</el-select>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"产品档次\">\n\t\t\t\t\t\t<el-radio-group v-model=\"queryData.gradeType\">\n\t\t\t\t\t\t    <el-radio :label=\"1\">低</el-radio>\n\t\t\t\t\t\t    <el-radio :label=\"2\">中</el-radio>\n\t\t\t\t\t\t    <el-radio :label=\"3\">高</el-radio>\n\t\t\t\t\t\t</el-radio-group>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"商品运费\">\n\t\t\t\t\t\t<el-input v-model=\"queryData.expMoney\" v-if=\"!expMoneyStatus\" :placeholder=\"'请输入商品运费'\" style=\"width: 250px;\"></el-input>\n\t\t\t\t\t\t<el-select v-else v-model=\"queryData.expId\" filterable placeholder=\"请选择运费模板\" style=\"width: 250px;\">\n\t\t\t\t\t\t    <el-option v-for=\"item in queryExpRuleList\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\n\t\t\t\t\t\t</el-select>\n\t\t\t\t\t\t<el-checkbox v-model=\"expMoneyStatus\" style=\"margin-left: 20px;\" @change=\"expMoneyChange\">按运费模板计算</el-checkbox>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"起始销量\">\n\t\t\t\t\t\t<el-input v-model.number=\"queryData.startSales\" placeholder=\"请输入起始销量\"></el-input>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item label=\"商品状态\">\n\t\t\t\t\t\t<el-switch v-model=\"queryData.isShelves\"></el-switch>\n\t\t\t\t\t\t<span v-show=\"queryData.isShelves\" style=\"color: #409EFF;margin-left: 6px;\">上架状态</span>\n\t\t\t\t\t\t<span v-show=\"!queryData.isShelves\" style=\"color: #999;margin-left: 6px;\">下架状态</span>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item style=\"clear: both;width: 800px;\" label=\"商品详情\" >\n\t\t\t\t\t  <tinymce :id=\"'agreement_' + queryData.id\" v-model=\"queryData.content\" :height=\"600\"/>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t\t<el-form-item>\n\t\t\t\t\t\t<!-- <el-button type=\"infor\" style=\"width: 200px;\">保存</el-button> -->\n\t\t\t\t\t\t<el-button type=\"primary\" style=\"width: 200px;\" @click=\"nextStpe(0,'ruleForm')\">下一步</el-button>\n\t\t\t\t\t</el-form-item>\n\t\t\t\t</el-form>\n\t\t\t</div>\n\t\t\t<!--  -->\n\t\t\t<div class=\"tab-content\" v-show=\"tabSelectVal === 'second'\">\n\t\t\t\t<div class=\"tab-title\">\n\t\t\t\t\t<span>关联分类</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tab-content-tag\">\n\t\t\t\t\t<span style=\"color:red;font-size: 13px;\">选择要关联的分类，点击添加</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tab-content-tag\" v-show=\"classifyTags.length > 0\">\n\t\t\t\t\t<el-tag v-for=\"(item,index) in classifyTags\" :key=\"index\" closable @close=\"classifyTagsClose(index)\">{{item.name}}</el-tag>\n\t\t\t\t\t<!-- <el-button icon=\"el-icon-plus\" type=\"primary\" size=\"small\" style=\"margin-left: 10px;\">新增</el-button> -->\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tab-content-tag\">\n\t\t\t\t\t<!-- <el-select v-model=\"classifyTagsValue\" filterable placeholder=\"请选择\" size=\"medium\" style=\"width: 400px;\">\n\t\t\t\t\t\t<el-option v-for=\"item in classifyTagsOptions\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\n\t\t\t\t\t</el-select> -->\n\t\t\t\t\t<el-cascader ref=\"cascader\" v-model=\"classifyTagsValue\" @change=\"classifyTagsChange\" size=\"medium\" style=\"width: 400px;\" :props=\"props\" :show-all-levels=\"false\"></el-cascader>\n\t\t\t\t\t<el-button type=\"primary\" size=\"medium\" icon=\"el-icon-plus\" style=\"margin-left: 10px;\" @click=\"classifyTagsHandle\">添加</el-button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tab-title\">\n\t\t\t\t\t<span>分类关联商品</span>\n\t\t\t\t</div>\n\t\t\t\t<el-table ref=\"multipleTable\" :data=\"classifyTags\" style=\"width: 980px\" border :header-cell-style=\"{backgroundColor:'#f5f5f5'}\">\n\t\t\t\t\t<el-table-column prop=\"orderSn\" label=\"序号\" width=\"100\" align=\"center\">\n\t\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t\t<span>{{scope.$index + 1}}</span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</el-table-column>\n\t\t\t\t\t<el-table-column prop=\"name\"  label=\"分类\" width=\"170\" align=\"center\"></el-table-column>\n\t\t\t\t\t<el-table-column  label=\"是否必选\" width=\"130\" align=\"center\">\n\t\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t\t<el-switch v-model=\"scope.row.isMandatory\"></el-switch>\n\t\t\t\t\t\t </template>\n\t\t\t\t\t</el-table-column>\n\t\t\t\t\t<el-table-column label=\"是否多选\" width=\"130\" align=\"center\">\n\t\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t\t<el-switch v-model=\"scope.row.isChoice\"></el-switch>\n\t\t\t\t\t\t </template>\n\t\t\t\t\t</el-table-column>\n\t\t\t\t\t<el-table-column label=\"默认商品\" width=\"200\" align=\"center\">\n\t\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t\t<span>{{scope.row.productName || '无'}}</span>\n\t\t\t\t\t\t </template>\n\t\t\t\t\t</el-table-column>\n\t\t\t\t\t<!-- <el-table-column label=\"价格\" width=\"100\" align=\"center\">\n\t\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t\t<span>{{scope.row.price || '0'}}</span>\n\t\t\t\t\t\t </template> -->\n\t\t\t\t\t</el-table-column>\n\t\t\t\t\t<el-table-column label=\"关联商品\" align=\"center\">\n\t\t\t\t\t\t<template slot-scope=\"scope\">\n\t\t\t\t\t\t\t<el-button type=\"text\" style=\"font-size: 14px;\" @click=\"relationShow(scope.row,scope.$index)\">{{scope.row.productNum}}</el-button>\n\t\t\t\t\t\t </template>\n\t\t\t\t\t</el-table-column>\n\t\t\t\t</el-table>\n\t\t\t\t<div style=\"height: 30px;\"></div>\n\t\t\t\t<el-button type=\"infor\" style=\"width: 200px;\" @click=\"tabSelectVal = 'first'\">上一步</el-button>\n\t\t\t\t<el-button type=\"primary\" style=\"width: 200px;\" @click=\"nextStpe(2,'ruleForm')\">保存</el-button>\n\t\t\t</div>\n\t\t\t<!--  -->\n\t\t\t<el-dialog title=\"关联商品\" :visible.sync=\"dialogVisible\" width=\"810px\" :show-close=\"false\" :close-on-press-escape=\"false\" :close-on-click-modal=\"false\">\n\t\t\t\t<div class=\"relation-box\">\n\t\t\t\t\t<div class=\"tab-title\">\n\t\t\t\t\t\t<span>已关联商品</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"relation-list\" v-if=\"relationData.relatedOuts.length > 0\">\n\t\t\t\t\t\t<div class=\"relation-item\" v-for=\"(item,index) in relationData.relatedOuts\" :key=\"index\">\n\t\t\t\t\t\t\t<i class=\"el-icon-close\" @click=\"relationConfirm(0,index)\"></i>\n\t\t\t\t\t\t\t<el-image style=\"width: 120px; height: 120px;margin-bottom: 6px;border: 1px solid #F4F4F5;\" :src=\"item.coverImage\" fit=\"fill\"></el-image>\n\t\t\t\t\t\t\t<el-button style=\"width: 100%;margin-bottom: 4px;\" :type=\"item.isDefault? 'primary' : 'infor'\" size=\"small\" @click=\"setDefault(index)\">{{item.isDefault?'已设为默认':'设为默认'}}</el-button>\n\t\t\t\t\t\t\t<span style=\"line-height: 1.2;\" :title=\"item.title\">{{item.title}}</span>\n\t\t\t\t\t\t\t<span :title=\"item.simpleDesc\">{{item.simpleDesc || '暂无简介'}}</span>\n\t\t\t\t\t\t\t<span>{{item.price}}元</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style=\"display: flex;justify-content: center;padding: 40px 0;color: #787878;\" v-else><span>暂无已关联商品</span></div>\n\t\t\t\t</div>\n\t\t\t\t<div style=\"height: 1px;border-bottom: 1px solid #F4F4F5;margin: 16px 0;\"></div>\n\t\t\t\t<div class=\"relation-box\">\n\t\t\t\t\t<div class=\"tab-title\">\n\t\t\t\t\t\t<span>可关联商品</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"relation-list\" v-if=\"relationData.notRelatedOuts.length > 0\">\n\t\t\t\t\t\t<div class=\"relation-item\" v-for=\"(item,index) in relationData.notRelatedOuts\" :key=\"index\">\n\t\t\t\t\t\t\t<el-image style=\"width: 120px; height: 120px;margin-bottom: 6px;border: 1px solid #F4F4F5;\" :src=\"item.coverImage\" fit=\"fill\"></el-image>\n\t\t\t\t\t\t\t<el-button style=\"width: 100%;margin-bottom: 4px;\" type=\"infor\" size=\"small\" @click=\"relationConfirm(1,index)\">确认关联</el-button>\n\t\t\t\t\t\t\t<span style=\"line-height: 1.2;\" :title=\"item.title\">{{item.title}}</span>\n\t\t\t\t\t\t\t<span :title=\"item.simpleDesc\">{{item.simpleDesc || '暂无简介'}}</span>\n\t\t\t\t\t\t\t<span>{{item.price}}元</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style=\"display: flex;justify-content: center;padding: 40px 0;color: #787878;\" v-else><span>暂无可关联商品</span></div>\n\t\t\t\t</div>\n\t\t\t\t<span slot=\"footer\">\n\t\t\t\t\t<el-button type=\"primary\" @click=\"relationSubmit\">确 定</el-button>\n\t\t\t\t</span>\n\t\t\t</el-dialog>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n\timport {queryProductParts,queryInstallProductParts,queryProductRelated,editProductInstall,editProductParts,queryExpRule,getProductInstall,installedModelList} from '@/api/install.js'\n\timport {queryProductCategoryFn} from '@/api/product.js'\n\timport uploadImg from \"@/components/uploadImg/upload-img.vue\";\n\timport uploadImgs from \"@/components/uploadImgs/upload-imgs.vue\";\n\timport lodash from 'lodash'\n\timport Tinymce from \"@/components/Tinymce\";\n\texport default{\n\t\tname: \"instalEdit\",\n\t\tcomponents: {\n\t\t  uploadImg,\n\t\t  uploadImgs,\n\t\t  Tinymce\n\t\t},\n\t\tdata(){\n\t\t\treturn{\n\t\t\t\tqueryData:{\n\t\t\t\t\tname:'',\n\t\t\t\t\tdescVal:'',\n\t\t\t\t\timg:'',\n\t\t\t\t\tcarouselImg:[],\n\t\t\t\t\tappletCarouselImg:[],\n\t\t\t\t\texpType:2,   //运费类型 1运费模板计算 2固定金额 ,\n\t\t\t\t\texpMoney:'' ,\n\t\t\t\t\texpId:'',\n\t\t\t\t\tstartSales:'',\n\t\t\t\t\tisShelves:true,  // 0下架 1上架\n\t\t\t\t\ttype:1,   // 类型 1 整机 2 加工中心\n\t\t\t\t\tmodelId:'',  // 装机型号\n\t\t\t\t\tgradeType:1   ,//装机产品档次 1低 2中 3高 ,\n\t\t\t\t\tcontent:'',\n\t\t\t\t\tid:'',\n\t\t\t\t},\n\t\t\t\texpMoneyStatus:false,\n\t\t\t\tfirstRules:{\n\t\t\t\t\t name:[\n\t\t\t\t\t\t{ required: true, message: '请输入商品名称', trigger: 'blur' },\n\t\t\t\t\t ],\n\t\t\t\t\t img:[\n\t\t\t\t\t \t{ required: true, message: '请上传装机封面图', trigger: 'upload' },\n\t\t\t\t\t ],\n\t\t\t\t\t carouselImg:[\n\t\t\t\t\t\t{ required: true, message: '请上传装机轮播图', trigger: 'upload' },\n\t\t\t\t\t ],\n\t\t\t\t\t appletCarouselImg:[\n\t\t\t\t\t\t{ required: true, message: '请上传小程序装机轮播图', trigger: 'upload' },\n\t\t\t\t\t ],\n\t\t\t\t\t modelId:[\n\t\t\t\t\t\t { required: true, message: '请上选择产品型号', trigger: 'change' },\n\t\t\t\t\t ]\n\t\t\t\t},\n\t\t\t\ttabSelectVal:'first',\n\t\t\t\ttabs:[\n\t\t\t\t\t{name:'商品信息',lable:'first'},\n\t\t\t\t\t{name:'装机配置',lable:'second'}\n\t\t\t\t],\n\t\t\t\tclassifyTags:[],\n\t\t\t\tclassifyTagsOptions:[],\n\t\t\t\tclassifyTagsValue:[],\n\t\t\t\t// \n\t\t\t\tdialogVisible:false,\n\t\t\t\tdialogIndex:0,\n\t\t\t\trelationData:{  // 关联商品数据\n\t\t\t\t\tnotRelatedOuts:[],   // 未关联商品 \n\t\t\t\t\trelatedOuts:[],   // 已关联商品 \n\t\t\t\t},\n\t\t\t\tqueryExpRuleList:[],\n\t\t\t\tid:'',  // 装机id\n\t\t\t\t// 联级分类\n\t\t\t\tprops: {\n\t\t\t\t\tlazy: true,\n\t\t\t\t\tlazyLoad (node, resolve) {\n\t\t\t\t\t\tconst { level } = node;\n\t\t\t\t\t\tqueryProductCategoryFn({pid:node.value || 0}).then(res=>{\n\t\t\t\t\t\t\tconst resData = res.data;\n\t\t\t\t\t\t\tconst nodes = resData.map(item=>({\n\t\t\t\t\t\t\t\tvalue: item.id,\n\t\t\t\t\t\t\t\tlabel: item.name,\n\t\t\t\t\t\t\t\tleaf: level >= 1\n\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\tresolve(nodes)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tlabelName:'',  // 选中的装机分类名称\n\t\t\t\tinstallSubType:[],\n\t\t\t}\n\t\t},\n\t\tasync created(){\n\t\t\tthis.id = this.$route.query.id\n\t\t\t await this.installedModelList(this.queryData.type)\n\t\t\tthis.getClassifyInfo(this.id)\n\t\t\tthis.getQueryExpRule()\n\t\t},\n\t\tasync activated() {\n\t\t\tthis.id = this.$route.query.id\n\t\t\tawait this.installedModelList(this.queryData.type)\n\t\t\tthis.getClassifyInfo(this.id)\n\t\t\tthis.getQueryExpRule()\n\t\t},\n\t\tmethods:{\n\t\t\t// 返回上一页\n\t\t\tgoBack(){\n\t\t\t\tthis.$router.go(-1)\n\t\t\t},\n\t\t\tinstallTypeChange(type){\n\t\t\t\tthis.installedModelList(type)\n\t\t\t},\n\t\t\t// 获取装机型号列表\n\t\t\tasync installedModelList(type){\n\t\t\t\tconst res = await installedModelList({\n\t\t\t\t\ttype\n\t\t\t\t})\n\t\t\t\tif(res.code === '000'){\n\t\t\t\t\tthis.installSubType = res.data\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 获取运费模板\n\t\t\tasync getQueryExpRule(){\n\t\t\t\tconst res = await queryExpRule({\n\t\t\t\t\tpageNo:1,\n\t\t\t\t\tpageSize:50\n\t\t\t\t})\n\t\t\t\tif(res.code === '000'){\n\t\t\t\t\tthis.queryExpRuleList = res.data.records\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 运费方式切换\n\t\t\texpMoneyChange(val){\n\t\t\t\tif(val){\n\t\t\t\t\tthis.queryData.expMoney = ''\n\t\t\t\t\tthis.queryData.expType = 1\n\t\t\t\t}else{\n\t\t\t\t\tthis.queryData.expId = ''\n\t\t\t\t\tthis.queryData.expType = 2\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 获取装机信息\n\t\t\tasync getClassifyInfo(id){\n\t\t\t\tif(!id) return\n\t\t\t\tlet res = await getProductInstall({\n\t\t\t\t\tpageNo: id? undefined : 1,\n\t\t\t\t\tpageSize:id? undefined : 50,\n\t\t\t\t\tid:id || undefined\n\t\t\t\t})\n\t\t\t\tres = this.resDataFn(res)\n\t\t\t\t\n\t\t\t\tres.carouselImg = res.carouselImg ? res.carouselImg.split(',') : []\n\t\t\t\tres.appletCarouselImg = res.appletCarouselImg ? res.appletCarouselImg.split(',') : []\n\t\t\t\tthis.classifyTags = res.data\n\t\t\t\tres.data.forEach(item=>{\n\t\t\t\t\titem.isChoice = item.isChoice ? true : false\n\t\t\t\t\titem.isMandatory = item.isMandatory ? true : false\n\t\t\t\t})\n\t\t\t\tfor(let i in this.queryData){\n\t\t\t\t\tfor(let j in res){\n\t\t\t\t\t\tif(i === j){\n\t\t\t\t\t\t\tthis.queryData[i] = res[j]\n\t\t\t\t\t\t\tif(i === 'isShelves'){\n\t\t\t\t\t\t\t\tthis.queryData[i] = this.queryData[i] ? true : false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(i === 'expType'){\n\t\t\t\t\t\t\t\tif(this.queryData[i] === 1){   // 运费模板计算\n\t\t\t\t\t\t\t\t\tthis.expMoneyStatus = true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(this.queryData[i] === 2){   // 固定金额\n\t\t\t\t\t\t\t\t\tthis.expMoneyStatus = false\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// this.queryData.id = res.data.id\n\t\t\t\t// this.queryData.content = res.data.content\n\t\t\t},\n\t\t\t// 选择分类\n\t\t\tclassifyTagsChange(val){\n\t\t\t\tthis.labelName = this.$refs.cascader.getCheckedNodes()[0].label\n\t\t\t\t/* for(let i in res.records){\n\t\t\t\t\tres.records[i].classifyId = res.records[i].id\n\t\t\t\t\tres.records[i].isChoice = false\n\t\t\t\t\tres.records[i].isMandatory = false\n\t\t\t\t\tres.records[i].productId = ''\n\t\t\t\t\tres.records[i].productIds = []\n\t\t\t\t\tres.records[i].productNum = 0\n\t\t\t\t\tres.records[i].skuId = ''\n\t\t\t\t\tres.records[i].productName = '未设置'\n\t\t\t\t}\n\t\t\t\tthis.classifyTagsOptions = res.records */\n\t\t\t},\n\t\t\t// 添加关联分类\n\t\t\tclassifyTagsHandle(){\n\t\t\t\t// let item = this.classifyTagsOptions.filter(item=>item.id === this.classifyTagsValue)\n\t\t\t\tlet item = [\n\t\t\t\t\t{\n\t\t\t\t\t\tid:'',\n\t\t\t\t\t\tclassifyId:this.classifyTagsValue[1],\n\t\t\t\t\t\tname:this.labelName,\n\t\t\t\t\t\tisChoice:false,\n\t\t\t\t\t\tisMandatory:false,\n\t\t\t\t\t\tproductId:'',\n\t\t\t\t\t\tproductIds:[],\n\t\t\t\t\t\tproductNum:0,\n\t\t\t\t\t\tskuId:'',\n\t\t\t\t\t\tproductName:'未设置',\n\t\t\t\t\t\t// price:0,\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t\tif(item.length > 0){\n\t\t\t\t\tlet index = this.classifyTags.findIndex(p=>p.classifyId === item[0].classifyId)\n\t\t\t\t\tif(index === -1){\n\t\t\t\t\t\tthis.classifyTags.push(item[0])\n\t\t\t\t\t\t// this.labelName = ''\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.$message.error('该分类已存在，请勿重复添加');\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tthis.$message.error('请选要添加的分类');\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 删除关联分类\n\t\t\tclassifyTagsClose(i){\n\t\t\t\tthis.classifyTags = this.classifyTags.filter((item,index)=>index !== i)\n\t\t\t},\n\t\t\tuploadSucFn(img) {\n\t\t\t  this.queryData.img = img;\n\t\t\t},\n\t\t\tuploadImgsSucFn(img) {\n\t\t\t  this.queryData.carouselImg.push(img);\n\t\t\t},\n\t\t\t//小程序轮播图上传\n\t\t\tuploadappletImgsSucFn(img) {\n\t\t\t\tthis.queryData.appletCarouselImg.push(img);\n\t\t\t},\n\t\t\tdeleteImgFn(index) {\n\t\t\t  this.queryData.carouselImg.splice(index, 1);\n\t\t\t},\n\t\t\t//小程序轮播图删除\n\t\t\tdeleteappletImgFn(index) {\n\t\t\t  this.queryData.appletCarouselImg.splice(index, 1);\n\t\t\t},\n\t\t\t// 下一步 & 提交\n\t\t\tnextStpe(type,formName) {\n\t\t\t\tif(type === 0){\n\t\t\t\t\tthis.$refs[formName].validate((valid) => {\n\t\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tthis.tabSelectVal = 'second'\n\t\t\t\t\t\t\tconsole.log(this.queryData)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\t\n\t\t\t\t}else if(type === 2){\n\t\t\t\t\tthis.$refs[formName].validate(async (valid) => {\n\t\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\t\tthis.tabSelectVal = 'first'\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tif(this.classifyTags.length === 0){\n\t\t\t\t\t\t\t\tthis.$message.error('请先关联分类');\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tconst index = this.classifyTags.findIndex(item=>item.productNum === 0)\n\t\t\t\t\t\t\t\tif(index !== -1){\n\t\t\t\t\t\t\t\t\tthis.$message.error('分类\"'+ this.classifyTags[index].name +'\"未设置关联商品');\n\t\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst arr = lodash.cloneDeep(this.classifyTags)\n\t\t\t\t\t\t\t\tarr.forEach(item=>{\n\t\t\t\t\t\t\t\t\titem.isChoice = item.isChoice ? 1 : 0\n\t\t\t\t\t\t\t\t\titem.isMandatory = item.isMandatory ? 1 : 0\n\t\t\t\t\t\t\t\t\titem.productIds = typeof item.productIds !== 'string' ? item.productIds.join(',') : item.productIds\n\t\t\t\t\t\t\t\t\tdelete item.name\n\t\t\t\t\t\t\t\t\tdelete item.productName\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tconst data = {\n\t\t\t\t\t\t\t\t\tappletCarouselImg:this.queryData.appletCarouselImg.join(','),\n\t\t\t\t\t\t\t\t\tcarouselImg: this.queryData.carouselImg.join(','),\n\t\t\t\t\t\t\t\t\tdescVal: this.queryData.descVal,\n\t\t\t\t\t\t\t\t\texpId: this.expMoneyStatus ? this.queryData.expId : undefined,\n\t\t\t\t\t\t\t\t\texpMoney: this.expMoneyStatus ? undefined : this.queryData.expMoney,\n\t\t\t\t\t\t\t\t\texpType: this.queryData.expType,\n\t\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\t\timg: this.queryData.img,\n\t\t\t\t\t\t\t\t\tisShelves: this.queryData.isShelves ? 1 : 0,\n\t\t\t\t\t\t\t\t\tlist: arr.length > 0 ? arr : null,\n\t\t\t\t\t\t\t\t\tname: this.queryData.name,\n\t\t\t\t\t\t\t\t\tstartSales: this.queryData.startSales,\n\t\t\t\t\t\t\t\t\ttype:this.queryData.type ?? 1,\n\t\t\t\t\t\t\t\t\tmodelId:this.queryData.modelId,\n\t\t\t\t\t\t\t\t\tgradeType:this.queryData.gradeType ?? 1,\n\t\t\t\t\t\t\t\t\tcontent:this.queryData.content\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst loading = this.$loading()\n\t\t\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\t\t\tconst res = await editProductInstall(data)\n\t\t\t\t\t\t\t\t\tif(res.code === '000'){\n\t\t\t\t\t\t\t\t\t\tthis.$message({\n\t\t\t\t\t\t\t\t\t\t\tshowClose: true,\n\t\t\t\t\t\t\t\t\t\t\tmessage: '操作成功！',\n\t\t\t\t\t\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tthis.goBack()\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tloading.close()\n\t\t\t\t\t\t\t\t}catch(e){\n\t\t\t\t\t\t\t\t\tloading.close()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 查看关联商品\n\t\t\tasync relationShow(data,index){\n\t\t\t\tthis.dialogIndex = index\n\t\t\t\tconst loading = this.$loading()\n\t\t\t\ttry{\n\t\t\t\t\tconst res = await queryProductRelated({\n\t\t\t\t\t\tclassifyId:data.classifyId,\n\t\t\t\t\t\tid:this.id ? data.id : undefined\n\t\t\t\t\t})\n\t\t\t\t\tif(res.code === '000'){\n\t\t\t\t\t\tif(res.data.relatedOuts === null){\n\t\t\t\t\t\t\tres.data.relatedOuts = []\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// 所有已关联商品默认为默认选择\n\t\t\t\t\t\t\tfor(let i in res.data.relatedOuts){\n\t\t\t\t\t\t\t\tres.data.relatedOuts[i].isDefault = 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(res.data.notRelatedOuts === null){\n\t\t\t\t\t\t\tres.data.notRelatedOuts = []\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.relationData = res.data\n\n\t\t\t\t\t\tthis.dialogVisible = true\n\t\t\t\t\t}\n\t\t\t\t\tloading.close()\n\t\t\t\t}catch(e){\n\t\t\t\t\tloading.close()\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 设置关联\n\t\t\trelationConfirm(e,index){\n\t\t\t\tlet item\n\t\t\t\tif(e === 0){\n\t\t\t\t\titem = this.relationData.relatedOuts[index]\n\t\t\t\t\tthis.relationData.notRelatedOuts.push(item)\n\t\t\t\t\tthis.relationData.relatedOuts.splice(index,1)\n\t\t\t\t}else{\n\t\t\t\t\titem = this.relationData.notRelatedOuts[index]\n\t\t\t\t\tthis.relationData.relatedOuts.push(item)\n\t\t\t\t\tthis.relationData.notRelatedOuts.splice(index,1)\n\t\t\t\t\t// this.relationData.relatedOuts.forEach(item=>item.isDefault = 0)\n\t\t\t\t\tthis.relationData.relatedOuts.forEach(item=>item.isDefault = 1)\n\t\t\t\t}\n\t\t\t},\n\t\t\t// 设为默认\n\t\t\tsetDefault(index){\n\t\t\t\t/* for(let i in this.relationData.relatedOuts){\n\t\t\t\t\tthis.relationData.relatedOuts[i].isDefault = false\n\t\t\t\t}\n\t\t\t\tthis.relationData.relatedOuts[index].isDefault = true */\n\t\t\t},\n\t\t\t// 提交关联修改\n\t\t\trelationSubmit(){\n\t\t\t\tthis.dialogVisible = false\n\t\t\t\tthis.classifyTags[this.dialogIndex].productNum = this.relationData.relatedOuts.length\n\t\t\t\t// this.classifyTags[this.dialogIndex].price\n\t\t\t\t\n\t\t\t\tlet index = this.relationData.relatedOuts.findIndex(item=>item.isDefault)\n\t\t\t\tif(index >= 0){\n\t\t\t\t\t// this.classifyTags[this.dialogIndex].productName = this.relationData.relatedOuts[index].title || '未设置'\n\t\t\t\t\t// this.classifyTags[this.dialogIndex].productId = this.relationData.relatedOuts[index].id\n\t\t\t\t\t// this.classifyTags[this.dialogIndex].price = this.relationData.relatedOuts[index].price\n\t\t\t\t}else{\n\t\t\t\t\tthis.classifyTags[this.dialogIndex].price = 0\n\t\t\t\t\tthis.classifyTags[this.dialogIndex].productName = '未设置'\n\t\t\t\t\tthis.classifyTags[this.dialogIndex].productId = ''\n\t\t\t\t}\n\t\t\t\t// \n\t\t\t\tlet arr = []\n\t\t\t\tfor(let i in this.relationData.relatedOuts){\n\t\t\t\t\tarr.push(this.relationData.relatedOuts[i].title)\n\t\t\t\t}\n\t\t\t\tthis.classifyTags[this.dialogIndex].productName = arr.join('；')\n\t\t\t\t// \n\t\t\t\tthis.classifyTags[this.dialogIndex].productIds = this.relationData.relatedOuts.map(item=>{\n\t\t\t\t\treturn item.id\n\t\t\t\t})\n\t\t\t\t// console.log(this.classifyTags)\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n.manage-top{padding-bottom: 22px;}\n.demo-ruleForm{width: 500px;}\n.tab-title{display: flex;align-items: center;height: 40px;font-size: 15px;font-weight: bold;padding-bottom: 15px;}\n.el-tag+.el-tag {\n    margin-left: 10px;\n}\n.tab-content-tag{display: flex;align-items: center;margin-bottom: 16px;}\n/*  */\n.relation-list{display: flex;flex-wrap: wrap;}\n.relation-item{display: flex;flex-direction: column;align-items: center;width: 120px;position: relative;margin: 0 10px 10px 0;}\n.relation-item:nth-child(6n){margin-right: 0;}\n.relation-item>i{font-size: 20px;position: absolute;right: 0;top: 0;z-index: 10;cursor: pointer;padding: 4px;}\n.relation-item>i:hover{opacity: .8;}\n.relation-item>span{margin-top: 6px;color: #333;font-weight: normal;font-size: 12px;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;overflow: hidden;}\n.relation-item>span:nth-of-type(2){font-size: 12px;color: #666;font-weight: normal;}\n.relation-item>span:nth-of-type(3){font-size: 12px;color: red;font-weight: normal;}\n.relation-item:hover i{color: red;}\n</style>\n"]}]}