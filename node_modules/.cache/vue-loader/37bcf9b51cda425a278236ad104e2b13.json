{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\views\\maintenance\\assignedWorker.vue?vue&type=style&index=0&id=61d30f02&lang=less&scoped=true&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\views\\maintenance\\assignedWorker.vue","mtime":1712128216906},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\@vue\\cli-service\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\style-resources-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5vcGVyYXRpb25CdG4gew0KICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogIGNvbG9yOiAjMGIyMDU5Ow0KfQ0KLmFzc2lnbmVkV29ya2VyIHsNCiAgcGFkZGluZzogMjBweDsNCiAgLnNlYXJjaFRvb2wgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCg0KICAgIC53b3JrZXJOYW1lIHsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgaDQgew0KICAgICAgICB3aWR0aDogODBweDsNCiAgICAgIH0NCiAgICAgIC5pbnAgew0KICAgICAgICB3aWR0aDogMjUwcHg7DQogICAgICB9DQogICAgICAuYXNzaWduZWRXb3JrZXJMaXN0IHsNCiAgICAgICAgY29sb3I6ICMxMTg2ZjQ7DQoNCiAgICAgICAgLm5vdGl2ZVRleHQgew0KICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgICAgICBjb2xvcjogcmVkOw0KICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICBib3R0b206IC04cHg7DQogICAgICAgICAgbGVmdDogMjQuMyU7DQogICAgICAgICAgd2lkdGg6IDE2MHB4Ow0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLndvcmtlclRhYmxlIHsNCiAgICBtYXJnaW4tdG9wOiAyMHB4Ow0KICAgIC5wYWdpbmdUb29sIHsNCiAgICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["assignedWorker.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"assignedWorker.vue","sourceRoot":"src/views/maintenance","sourcesContent":["<template>\r\n  <div class=\"assignedWorker\">\r\n    <!-- 查询工具栏 -->\r\n    <div class=\"searchTool\">\r\n      <div class=\"workerName\">\r\n        <h4 style=\"color: #999\">师傅名称</h4>\r\n        <div class=\"inp\">\r\n          <el-input\r\n            clearable\r\n            placeholder=\"请输入你的师傅名称\"\r\n            v-model=\"params.realName\"\r\n          ></el-input>\r\n        </div>\r\n        <h4 style=\"color: #999; width: 90px; margin-left: 20px\">指派的师傅:</h4>\r\n        <div class=\"assignedWorkerList\">\r\n          <span\r\n            v-for=\"(item, index) in masterNameList\"\r\n            :key=\"item\"\r\n            class=\"item\"\r\n            @click=\"delAssignedWorker(index)\"\r\n          >\r\n            {{ item }}\r\n          </span>\r\n          <div class=\"notiveText\">( 注:点击姓名即可删除！)</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"operationBtnList\">\r\n        <!-- <el-button\r\n          class=\"thrownIntoMarketBtn\"\r\n          type=\"primary\"\r\n          @click=\"openRegionChooseDialog\"\r\n        >\r\n          区域指派</el-button\r\n        >\r\n        <el-button\r\n          class=\"thrownIntoMarketBtn\"\r\n          type=\"warning\"\r\n          @click=\"assignedBtn('market')\"\r\n          >抛入市场</el-button\r\n        > -->\r\n        <el-button type=\"primary\" @click=\"realNameBlurFn\"> 搜索 </el-button>\r\n        <el-button\r\n          class=\"thrownIntoMarketBtn\"\r\n          type=\"success\"\r\n          @click=\"handleTakeOrder\"\r\n          >代师傅接单</el-button\r\n        >\r\n        <el-button\r\n          class=\"thrownIntoMarketBtn\"\r\n          type=\"success\"\r\n          @click=\"assignedBtn('worker')\"\r\n          >指派师傅</el-button\r\n        >\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 师傅表格 -->\r\n    <div class=\"workerTable\">\r\n      <el-card>\r\n        <el-table\r\n          v-show=\"tableShow\"\r\n          height=\"70vh\"\r\n          :header-cell-style=\"{\r\n            background: '#f6f8fc',\r\n            color: '#707070',\r\n          }\"\r\n          :data=\"masterList\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-table-column label=\"多选\" align=\"center\" width=\"100px\">\r\n            <template slot-scope=\"{ row }\">\r\n              <input\r\n                type=\"checkbox\"\r\n                style=\"zoom: 120%\"\r\n                @click=\"manyPeopleAssigned(row.show, row.uid, row.realName)\"\r\n                v-model=\"row.show\"\r\n              />\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"师傅头像\" align=\"center\" width=\"100px\">\r\n            <template slot-scope=\"{ row }\">\r\n              <img :src=\"row.realPortrait\" width=\"75px\" height=\"75px\" />\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"realName\" label=\"师傅\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"phone\" label=\"师傅电话\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column prop=\"identity\" label=\"角色\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column label=\"服务状态\" align=\"center\">\r\n            <template> 可接单状态 </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"createTime\" label=\"入驻时间\" align=\"center\">\r\n          </el-table-column>\r\n          <el-table-column label=\"所属\" align=\"center\">\r\n            <template> 广东机床加工有限公司 </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" align=\"center\">\r\n            <template slot-scope=\"{ row }\">\r\n              <a\r\n                href=\"#\"\r\n                class=\"operationBtn\"\r\n                @click=\"\r\n                  $router.push('/maintenance/worker/workerDetails?id=' + row.id)\r\n                \"\r\n                >详情</a\r\n              >\r\n              <!-- <a href=\"#\" class=\"operationBtn\">订单</a> -->\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 底部分页 -->\r\n        <div class=\"pagingTool\">\r\n          <el-pagination\r\n            :total=\"total\"\r\n            :page-size=\"10\"\r\n            @current-change=\"currentChange\"\r\n            layout=\"total, prev, pager, next, jumper\"\r\n          ></el-pagination>\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n\r\n    <!-- 区域选择 -->\r\n    <el-dialog\r\n      title=\"区域指派\"\r\n      width=\"30%\"\r\n      :visible=\"regionChooseDialog\"\r\n      :show-close=\"false\"\r\n    >\r\n      <div class=\"content\">\r\n        <el-select\r\n          v-model=\"cityValue\"\r\n          placeholder=\"请选择市\"\r\n          style=\"margin-right: 20px\"\r\n          @change=\"cityValueChage\"\r\n        >\r\n          <el-option\r\n            v-for=\"item in cityList\"\r\n            :key=\"item.id\"\r\n            :label=\"item.name\"\r\n            :value=\"item.id\"\r\n          ></el-option>\r\n        </el-select>\r\n        <el-select\r\n          multiple\r\n          collapse-tags\r\n          placeholder=\"请选择区\"\r\n          v-model=\"districtValue\"\r\n        >\r\n          <el-option\r\n            v-for=\"item in districtList\"\r\n            :key=\"item.id\"\r\n            :label=\"item.name\"\r\n            :value=\"item.id\"\r\n          ></el-option>\r\n        </el-select>\r\n      </div>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"regionChooseDialog = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmRegionChoose\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { handleTakeOrder } from \"@/api/order\";\r\nimport { queryAssignableMasterList, handleAssignMaster } from \"@/api/user\";\r\nimport { addressFn } from \"@/api/system\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      districtValue: null,\r\n      districtList: null, //区级的列表\r\n      cityValue: null,\r\n      cityList: null, //市级的列表\r\n      regionChooseDialog: false,\r\n      enterpriseOrderSn: \"\", //指派需要的企业工单订单编号\r\n      params: {\r\n        // 师傅查询需要的数据\r\n        pageNo: 1,\r\n        pageSize: 10,\r\n        realName: \"\",\r\n      },\r\n      masterList: null, //师傅列表\r\n      total: null, //师傅总条数\r\n\r\n      masterUidList: [], //要指派师傅pdi的列表\r\n      masterNameList: [], //要指派师傅姓名的列表\r\n      tableShow: true,\r\n    };\r\n  },\r\n  methods: {\r\n    async handleTakeOrder() {\r\n      if (!(this.masterUidList.length > 0 && this.masterUidList.length < 2)) {\r\n        this.$message({\r\n          message: \"请选择一名师傅进行指派\",\r\n          type: \"warning\",\r\n        });\r\n        return;\r\n      }\r\n      let params = {\r\n        uid: this.masterUidList[0],\r\n        relationOrderSn: this.enterpriseOrderSn,\r\n      };\r\n      const res = await handleTakeOrder(params);\r\n      if (res.message == \"操作成功\") {\r\n        this.$message({\r\n          message: \"操作成功\",\r\n          type: \"success\",\r\n        });\r\n        this.$router.push({\r\n          name: \"maintenance_order_desc\",\r\n          query: { orderSn: this.enterpriseOrderSn },\r\n        });\r\n      }\r\n    },\r\n    // 确定区域\r\n    async confirmRegionChoose() {\r\n      const res = await handleAssignMaster({\r\n        areaIdList: this.districtValue,\r\n        enterpriseOrderSn: this.enterpriseOrderSn,\r\n        masterUidList: null,\r\n      });\r\n      if (res.message === \"操作成功\") {\r\n        this.$message({\r\n          message: \"指派成功\",\r\n          type: \"success\",\r\n        });\r\n        this.$router.push({\r\n          name: \"maintenance_order_desc\",\r\n          query: { orderSn: this.enterpriseOrderSn },\r\n        });\r\n      }\r\n    },\r\n    // 市级发生改变\r\n    async cityValueChage() {\r\n      // 获取区级\r\n      const districtList = await addressFn(this.cityValue);\r\n      this.districtList = districtList.data;\r\n    },\r\n    // 打开选择区域\r\n    openRegionChooseDialog() {\r\n      this.regionChooseDialog = true;\r\n    },\r\n    // 删除指派师傅\r\n    delAssignedWorker(index) {\r\n      this.$confirm(\r\n        \"您确定取消指派\" + this.masterNameList[index] + \"?\",\r\n        \"取消指派\",\r\n        {\r\n          type: \"warning\",\r\n        }\r\n      ).then(() => {\r\n        this.masterUidList.splice(index, 1);\r\n        this.masterNameList.splice(index, 1);\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"删除成功!\",\r\n        });\r\n      });\r\n    },\r\n    // 勾选指派多选框\r\n    manyPeopleAssigned(show, uid, name) {\r\n      if (!show) {\r\n        if (this.masterUidList.indexOf(uid) === -1) {\r\n          this.masterUidList.push(uid);\r\n        }\r\n        if (this.masterNameList.indexOf(name) === -1) {\r\n          this.masterNameList.push(name);\r\n        }\r\n      } else {\r\n        const uidIndex = this.masterUidList.indexOf(uid);\r\n        this.masterUidList.splice(uidIndex, 1);\r\n        const nameIndex = this.masterNameList.indexOf(name);\r\n        this.masterNameList.splice(nameIndex, 1);\r\n        console.log(this.masterUidList);\r\n      }\r\n    },\r\n    // 指派按钮\r\n    async assignedBtn(judge) {\r\n      let params = {\r\n        enterpriseOrderSn: this.enterpriseOrderSn,\r\n      };\r\n      if (judge === \"worker\") {\r\n        params.masterUidList = this.masterUidList;\r\n      } else {\r\n        params.masterUidList = [];\r\n      }\r\n      const res = await handleAssignMaster(params);\r\n      if (res.message === \"操作成功\") {\r\n        this.$message({\r\n          message: \"指派成功\",\r\n          type: \"success\",\r\n        });\r\n        this.$router.push({\r\n          name: \"maintenance_order_desc\",\r\n          query: { orderSn: this.enterpriseOrderSn },\r\n        });\r\n      }\r\n    },\r\n    // 输入框的值发生改变的事件\r\n    realNameBlurFn() {\r\n      this.params.pageNo = 1;\r\n      this.getMasterList();\r\n    },\r\n    // 页码发生改变的时候\r\n    currentChange(page) {\r\n      this.params.pageNo = page;\r\n      this.getMasterList();\r\n    },\r\n    // 获取可指派师傅列表\r\n    async getMasterList() {\r\n      const loading = this.$loading();\r\n      this.tableShow = false;\r\n      const res = await queryAssignableMasterList(this.params);\r\n      this.masterList = res.data.records;\r\n      this.masterList.forEach((item) => {\r\n        item.show = false;\r\n      });\r\n      this.total = res.data.total;\r\n      this.tableShow = true;\r\n      loading.close();\r\n    },\r\n  },\r\n  async created() {\r\n    const { masterNameList, masterUidList, orderSn } = this.$route.query;\r\n    if (masterNameList) {\r\n      masterNameList.forEach((item) => {\r\n        this.masterNameList.push(item);\r\n      });\r\n    }\r\n    if (masterUidList) {\r\n      masterUidList.forEach((item) => {\r\n        this.masterUidList.push(item);\r\n      });\r\n    }\r\n    // 获取广东省的市\r\n    const cityList = await addressFn(440000);\r\n    this.cityList = cityList.data;\r\n\r\n    this.enterpriseOrderSn = orderSn; //指派需要的企业工单订单编号\r\n    this.getMasterList();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.operationBtn {\r\n  margin-right: 10px;\r\n  color: #0b2059;\r\n}\r\n.assignedWorker {\r\n  padding: 20px;\r\n  .searchTool {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    position: relative;\r\n\r\n    .workerName {\r\n      display: flex;\r\n      align-items: center;\r\n      h4 {\r\n        width: 80px;\r\n      }\r\n      .inp {\r\n        width: 250px;\r\n      }\r\n      .assignedWorkerList {\r\n        color: #1186f4;\r\n\r\n        .notiveText {\r\n          font-size: 14px;\r\n          color: red;\r\n          position: absolute;\r\n          bottom: -8px;\r\n          left: 24.3%;\r\n          width: 160px;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .workerTable {\r\n    margin-top: 20px;\r\n    .pagingTool {\r\n      margin-top: 20px;\r\n      display: flex;\r\n      justify-content: center;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}