{"remainingRequest":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\loonUpload.vue?vue&type=style&index=0&id=5de5b3d3&lang=less&scoped=true&","dependencies":[{"path":"D:\\机将公司\\机将后台端\\background-management-system\\src\\components\\loonUpload.vue","mtime":1669707457667},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\@vue\\cli-service\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\style-resources-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\机将公司\\机将后台端\\background-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNjb250ZW50IHsKICB3aWR0aDogbWF4LWNvbnRlbnQ7CiAgaGVpZ2h0OiBtYXgtY29udGVudDsKICAjZmlsZSB7CiAgICBkaXNwbGF5OiBub25lOwogIH0KICAjYWRkIHsKICAgIHdpZHRoOiAxMDBweDsKICAgIGhlaWdodDogMTAwcHg7CiAgICBsaW5lLWhlaWdodDogMTAwcHg7CiAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgbWFyZ2luLWxlZnQ6IDJweDsKICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICBib3JkZXI6IDFweCBkYXNoZWQgI2MwY2NkYTsKICAgIG1hcmdpbjogNXB4OwogIH0KICAjYWRkOmhvdmVyIHsKICAgIGNvbG9yOiAjNDA5ZWZmOwogICAgYm9yZGVyLWNvbG9yOiAjNDA5ZWZmOwogIH0KICBpbWcgewogICAgd2lkdGg6IDEwMHB4OwogICAgaGVpZ2h0OiAxMDBweDsKICAgIG1hcmdpbjogNXB4OwogICAgYm9yZGVyLXJhZGl1czogMTBweDsKICB9CiAgdmlkZW8gewogICAgbWluLXdpZHRoOiAyMDBweDsKICAgIG1heC13aWR0aDogMjAwcHg7CiAgICBoZWlnaHQ6IDE1MHB4OwogICAgYm9yZGVyOiAxcHggc29saWQ7CiAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgfQogIC5kZWxldGVfaW1nIHsKICAgIHdpZHRoOiAxMDBweDsKICAgIGhlaWdodDogMTAwcHg7CiAgICBtYXJnaW46IDVweDsKICAgIGRpc3BsYXk6IG5vbmU7CiAgfQogIC5kZWxldGVfYWR1aW8gewogICAgbGluZS1oZWlnaHQ6IDU0cHg7CiAgfQogIC5kZWxldGVfdmlkZW8gewogICAgaGVpZ2h0OiAyMHB4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgcmlnaHQ6IDIwcHg7CiAgICB0b3A6IDRweDsKICB9CiAgLnVwbG9hZDpob3ZlciA+IC5kZWxldGVfaW1nIHsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgY29sb3I6ICNmZmY7CiAgICB3aWR0aDogMTAwcHg7CiAgICBoZWlnaHQ6IDEwMHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgbGluZS1oZWlnaHQ6IDEwMHB4OwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpOwogIH0KICAudXBsb2FkZWQ6aG92ZXIgPiAuZGVsZXRlX2ltZyB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGNvbG9yOiAjZmZmOwogICAgd2lkdGg6IDEwMHB4OwogICAgaGVpZ2h0OiAxMDBweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGxpbmUtaGVpZ2h0OiAxMDBweDsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC41KTsKICB9CiAgLnVwbG9hZCB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgd2lkdGg6IG1heC1jb250ZW50OwogICAgaGVpZ2h0OiBtYXgtY29udGVudDsKICB9CiAgLnVwbG9hZGVkIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICB3aWR0aDogbWF4LWNvbnRlbnQ7CiAgICBoZWlnaHQ6IG1heC1jb250ZW50OwogIH0KfQo="},{"version":3,"sources":["loonUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"loonUpload.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"content\">\n    <input\n      type=\"file\"\n      id=\"file\"\n      :ref=\"id\"\n      :accept=\"type\"\n      multiple=\"multiple\"\n      @change=\"fileChange\"\n    />\n\n    <div\n      id=\"add\"\n      v-show=\"uploadList.length + uploadedList.length < limit\"\n      @click=\"upload\"\n    >\n      <i class=\"el-icon-plus avatar-uploader-icon\"></i>\n    </div>\n    <div class=\"uploaded\" v-for=\"item in uploadedList\" :key=\"item.url\">\n      <!-- image/png,image/jpeg / image.*-->\n      <img\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        :src=\"item.url\"\n      />\n      <div\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_img\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- audio/mpeg,audio/ogg,audio/wav -->\n      <audio\n        v-show=\"type.indexOf('audio') > -1\"\n        :src=\"item.url\"\n        controls\n      ></audio>\n      <div\n        v-show=\"type.indexOf('audio') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_aduio\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- video/mp4,video/webm,video/ogg -->\n      <video\n        v-show=\"type.indexOf('video') > -1\"\n        :src=\"item.url\"\n        controls\n      ></video>\n      <i\n        class=\"el-icon-delete delete_video\"\n        v-show=\"type.indexOf('video') > -1\"\n        @click=\"remove(item.url)\"\n      ></i>\n      <!-- text/plain,text/html -->\n      <el-link\n        :href=\"item.url\"\n        v-show=\"type.indexOf('text') > -1\"\n        type=\"success\"\n        target=\"_Blank\"\n      >\n        {{ item.url.slice(item.url.lastIndexOf(\"/\") + 1) }}\n      </el-link>\n      <i\n        v-show=\"type.indexOf('text') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"el-icon-delete\"\n      ></i>\n    </div>\n\n    <div class=\"upload\" v-for=\"item in uploadList\" :key=\"item.url\">\n      <!-- image/png,image/jpeg / image.*-->\n      <img\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        :src=\"item.url\"\n      />\n      <div\n        v-show=\"type.indexOf('image') > -1 && type.indexOf('text') == -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_img\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- audio/mpeg,audio/ogg,audio/wav -->\n      <audio\n        v-show=\"type.indexOf('audio') > -1\"\n        :src=\"item.url\"\n        controls\n      ></audio>\n      <div\n        v-show=\"type.indexOf('audio') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"delete_aduio\"\n      >\n        <i class=\"el-icon-delete\"></i>\n      </div>\n      <!-- video/mp4,video/webm,video/ogg -->\n      <video\n        v-show=\"type.indexOf('video') > -1\"\n        :src=\"item.url\"\n        controls\n      ></video>\n      <i\n        class=\"el-icon-delete delete_video\"\n        v-show=\"type.indexOf('video') > -1\"\n        @click=\"remove(item.url)\"\n      ></i>\n      <!-- text/plain,text/html -->\n      <el-link\n        :href=\"item.url\"\n        v-show=\"type.indexOf('text') > -1\"\n        type=\"primary\"\n        target=\"_Blank\"\n      >\n        <!-- {{ item.url.slice(item.url.lastIndexOf('/')+1) }} -->\n        {{ item.file.name }}\n      </el-link>\n      <i\n        v-show=\"type.indexOf('text') > -1\"\n        @click=\"remove(item.url)\"\n        class=\"el-icon-delete\"\n      ></i>\n    </div>\n  </div>\n</template>\n<script>\nimport { uuid } from \"uuidv4\";\nimport { UploadImg } from \"@/api/system.js\";\nexport default {\n  name: \"loon-upload\",\n  props: [\"type\", \"folder\", \"limit\", \"size\"],\n  data() {\n    return {\n      id: \"\",\n      //暂存队列\n      uploadList: [],\n      //已存队列\n      uploadedList: [],\n    };\n  },\n  methods: {\n    upload() {\n      this.$refs[this.id].click();\n    },\n    isNull() {\n      return this.uploadList.length + this.uploadedList.length == 0;\n    },\n    async uploadFile() {\n      // loading\n      const loading = this.$loading({ text: \"上传中..\" });\n\n      //已上传数据\n      var result = [];\n      this.uploadedList.forEach((item) => {\n        result.push(item.url);\n      });\n      for (let i = 0; i < this.uploadList.length; i++) {\n        const formData = new FormData();\n\n        formData.append(\"file\", this.uploadList[i].file);\n        await UploadImg(formData)\n          .then((res) => {\n            result.push(res.data);\n          })\n          .catch(() => {\n            this.$message({\n              showClose: true,\n              message: `第${i + 1}份文件上传失败！`,\n              type: \"warning\",\n            });\n            loading.close();\n            throw new Error(\"上传失败\");\n          });\n      }\n      loading.close();\n      return result;\n    },\n    reset(urlArray = []) {\n      this.uploadList = [];\n      this.uploadedList = urlArray;\n      this.$forceUpdate();\n    },\n    fileChange() {\n      const uploadLength = this.uploadList.length;\n      const uploadedLength = this.uploadedList.length;\n      const canUploadCount = this.limit - uploadLength - uploadedLength;\n\n      const files = this.$refs[this.id].files;\n      const fileLength = this.$refs[this.id].files.length;\n      for (let i = 0; i < fileLength; i++) {\n        if (i > canUploadCount - 1) {\n          return;\n        }\n        if (this.size == undefined || files[i].size <= this.size) {\n          //生成预览图片\n          const url = window.URL.createObjectURL(files[i]);\n          this.uploadList.push({ url: url, file: files[i] });\n        } else {\n          this.$message.error(\"文件大小超过\" + this.size / 1024 / 1024 + \"M\");\n        }\n      }\n      // 这行代码很核心，没有这行会出现一个bug，无法重复上传同一张图片\n      this.$refs[this.id].value = \"\";\n    },\n    remove(url) {\n      this.uploadList = this.uploadList.filter((item) => {\n        if (item.url != url) {\n          return item;\n        }\n      });\n      this.uploadedList = this.uploadedList.filter((item) => {\n        if (item.url != url) {\n          return item;\n        }\n      });\n      // 结束了清除掉不必要的资源\n      window.URL.revokeObjectURL(url);\n    },\n  },\n  mounted() {\n    this.id = uuid();\n  },\n};\n</script>\n<style lang=\"less\" scoped>\n#content {\n  width: max-content;\n  height: max-content;\n  #file {\n    display: none;\n  }\n  #add {\n    width: 100px;\n    height: 100px;\n    line-height: 100px;\n    border-radius: 10px;\n    text-align: center;\n    margin-left: 2px;\n    -webkit-box-sizing: border-box;\n    box-sizing: border-box;\n    border: 1px dashed #c0ccda;\n    margin: 5px;\n  }\n  #add:hover {\n    color: #409eff;\n    border-color: #409eff;\n  }\n  img {\n    width: 100px;\n    height: 100px;\n    margin: 5px;\n    border-radius: 10px;\n  }\n  video {\n    min-width: 200px;\n    max-width: 200px;\n    height: 150px;\n    border: 1px solid;\n    border-radius: 8px;\n  }\n  .delete_img {\n    width: 100px;\n    height: 100px;\n    margin: 5px;\n    display: none;\n  }\n  .delete_aduio {\n    line-height: 54px;\n  }\n  .delete_video {\n    height: 20px;\n    position: relative;\n    right: 20px;\n    top: 4px;\n  }\n  .upload:hover > .delete_img {\n    display: block;\n    color: #fff;\n    width: 100px;\n    height: 100px;\n    text-align: center;\n    line-height: 100px;\n    position: absolute;\n    background: rgba(0, 0, 0, 0.5);\n  }\n  .uploaded:hover > .delete_img {\n    display: block;\n    color: #fff;\n    width: 100px;\n    height: 100px;\n    text-align: center;\n    line-height: 100px;\n    position: absolute;\n    background: rgba(0, 0, 0, 0.5);\n  }\n  .upload {\n    display: flex;\n    width: max-content;\n    height: max-content;\n  }\n  .uploaded {\n    display: flex;\n    width: max-content;\n    height: max-content;\n  }\n}\n</style>\n"]}]}